var Ze=Object.defineProperty;var $e=(n,t,i)=>t in n?Ze(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i;var e=(n,t,i)=>($e(n,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=i(a);fetch(a.href,r)}})();class _e{constructor(t){e(this,"width",1024);e(this,"height",512);e(this,"canvas");e(this,"ctx");e(this,"getCanvas",()=>this.canvas);e(this,"getCtx",()=>this.ctx);this.canvas=document.createElement("canvas"),this.canvas.id="canvas-background";const i=this.canvas.getContext("2d");if(i===null)throw new Error("Context not found");this.ctx=i,this.canvas.width=this.width,this.canvas.height=this.height,t.appendChild(this.canvas)}}class et{constructor(t){e(this,"canvasBorder");e(this,"canvasContainer");e(this,"getCanvasContainer",()=>this.canvasContainer);this.canvasBorder=document.createElement("div"),this.canvasBorder.id="canvas-border",this.canvasBorder.classList.add("box-shadow"),this.canvasContainer=document.createElement("div"),this.canvasContainer.id="canvas-container",this.canvasBorder.appendChild(this.canvasContainer),t.appendChild(this.canvasBorder)}}const Oe=n=>({x:n.offsetX,y:n.offsetY}),Pe=n=>{const t=M.getTileRows(),{x:i,y:s}=Oe(n);let a=null;return t.forEach(r=>{r.forEach(o=>{i>=o.x&&i<=o.x+o.width&&s>=o.y&&s<=o.y+o.height&&(a=o)})}),a},De=n=>{const t=M.getTileRows(),{x:i,y:s}=Oe(n);let a=null;return t.forEach(r=>{r.forEach(o=>{i>=o.x&&i<=o.x+o.width&&s>=o.y&&s<=o.y+o.height&&(a=o)})}),a};class We{constructor(t,i,s){e(this,"id");e(this,"x");e(this,"y");e(this,"width",64);e(this,"height",64);e(this,"sWidth",64);e(this,"sHeight",this.sWidth);e(this,"dWidth",64);e(this,"dHeight",this.dWidth);e(this,"dX");e(this,"dY");e(this,"drawGrid",()=>{h.ctxBackground.lineWidth=.1,h.ctxBackground.strokeStyle="black",h.ctxBackground.font=" 10px sans-serif",h.ctxBackground.fillStyle="white",h.ctxBackground.beginPath(),h.ctxBackground.strokeRect(this.x,this.y,this.width,this.height),h.ctxBackground.fillText(`${this.id}`,this.x+5,this.y+10),h.ctxBackground.fillText(`X:${this.x}-${this.x+64}`,this.x+5,this.y+30),h.ctxBackground.fillText(`Y:${this.y} ${this.y+64}`,this.x+5,this.y+50)});this.id=t,this.x=i,this.y=s,this.dX=i,this.dY=s}}const ve=n=>n[Math.floor(Math.random()*n.length)],Xe=({x:n,y:t})=>{const i=n+32,s=t+64/2;return{x:i,y:s}},ie=({imageScale:n,sourceSize:t,translateCorrection:i})=>-((n*t-t)/2)+i;class H extends We{constructor(i,s,a){super(i,s,a);e(this,"hasTower",!1);e(this,"towerBp",null);e(this,"image");e(this,"sX");e(this,"sY");e(this,"towerBpImage",null);e(this,"tileGrasCoords",[{sx:0*this.sWidth,sy:0*this.sHeight},{sx:0*this.sWidth,sy:1*this.sHeight},{sx:1*this.sWidth,sy:0*this.sHeight},{sx:1*this.sWidth,sy:1*this.sHeight},{sx:2*this.sWidth,sy:0*this.sHeight},{sx:2*this.sWidth,sy:1*this.sHeight},{sx:3*this.sWidth,sy:0*this.sHeight},{sx:3*this.sWidth,sy:1*this.sHeight}]);e(this,"getImgConfig",()=>ve(this.tileGrasCoords));e(this,"drawImg",()=>{this.image!==null&&h.ctxBackground.drawImage(this.image,this.sX,this.sY,this.sWidth,this.sHeight,this.dX,this.dY,this.dWidth,this.dHeight)});e(this,"setHasTower",()=>this.hasTower=!0);e(this,"setTowerBp",i=>{this.towerBp=i});e(this,"drawTowerBp",()=>{if(this.towerBp!==null){const{config:i}=this.towerBp,s=Y.imageController.getImage(i.bluePrint.id);h.ctxGame.drawImage(s,this.dX+ie({imageScale:i.imageScale,sourceSize:i.sWidth,translateCorrection:i.imageTranslateCorrection.x}),this.dY+ie({imageScale:i.imageScale,sourceSize:i.sHeight,translateCorrection:i.imageTranslateCorrection.y}),i.imageScale*i.sWidth,i.imageScale*i.sHeight);const a=Xe({x:this.x,y:this.y});h.ctxGame.beginPath(),h.ctxGame.arc(a.x,a.y,i.range,0,Math.PI*2),h.ctxGame.fillStyle="rgba(225,225,225,0.1)",h.ctxGame.fill()}});e(this,"updateBG",()=>{this.drawImg()});e(this,"update",()=>{this.towerBp!==null&&this.drawTowerBp()});this.image=Y.imageController.getImage("textures"),this.sX=this.getImgConfig().sx,this.sY=this.getImgConfig().sy}}class je extends We{constructor(i,s,a,r){super(i,s,a);e(this,"sX");e(this,"sY");e(this,"horizontalTilePathsCoords",[{sx:2*this.sWidth,sy:2*this.sHeight},{sx:3*this.sWidth,sy:2*this.sHeight}]);e(this,"verticalTilePathsCoords",[{sx:1*this.sWidth,sy:2*this.sHeight},{sx:1*this.sWidth,sy:3*this.sHeight}]);e(this,"cornerTilePathCoords",{sx:0*this.sWidth,sy:2*this.sHeight});e(this,"direction");e(this,"getImgConfig",()=>{let i;switch(this.direction){case"horizontal":i=ve(this.horizontalTilePathsCoords);break;case"vertical":i=ve(this.verticalTilePathsCoords);break;default:i=this.cornerTilePathCoords}return i});e(this,"drawImg",()=>{const i=Y.imageController.getImage("textures");h.ctxBackground.drawImage(i,this.sX,this.sY,this.sWidth,this.sHeight,this.dX,this.dY,this.dWidth,this.dHeight)});e(this,"updateBG",()=>{this.drawImg()});this.direction=r,this.sX=this.getImgConfig().sx,this.sY=this.getImgConfig().sy}}class tt{constructor(t){e(this,"element");e(this,"scaleInTransformIn",[{transform:"translate(-50%, -50%) scale(0.5)"},{transform:"translate(-50%, -50%) scale(1)"}]);e(this,"scaleInTransformOut",[{transform:"translate(-50%, -50%) scale(1)"},{transform:"translate(-50%, -50%) scale(0.5)"}]);e(this,"scaleInTiming",100);e(this,"remove",()=>{this.element.animate(this.scaleInTransformOut,this.scaleInTiming),setTimeout(()=>{this.element.remove()},this.scaleInTiming)});this.element=document.createElement("h2"),this.element.id="info-message",this.element.innerHTML=t,document.body.appendChild(this.element),this.element.animate(this.scaleInTransformIn,this.scaleInTiming),setTimeout(()=>{this.remove()},1e3)}}class it{constructor(t){e(this,"width",1024);e(this,"height",512);e(this,"canvas");e(this,"ctx");e(this,"previousTileForHover",null);e(this,"getCanvas",()=>this.canvas);e(this,"getCtx",()=>this.ctx);e(this,"mouseMoveCallback",t=>{this.showTowerBpOnTile(t)});e(this,"mouseLeaveCallback",t=>{this.resetPreviousTileForHover()});e(this,"clickCallback",t=>{this.showTowerRange(t),this.placeTowerOnTile(t)});e(this,"showTowerBpOnTile",t=>{const i=m.menu.getSelectedTower();if(i===null)return;const s=De(t);this.previousTileForHover!==s&&(this.previousTileForHover instanceof H&&this.previousTileForHover.setTowerBp(null),s instanceof H&&!s.hasTower&&(s.setTowerBp(i),h.body.removeAllClassesFromBody(),s.update()),(s instanceof H&&!s.towerBp||s instanceof je)&&h.body.addTowerMouseCursor(i),this.previousTileForHover=s)});e(this,"resetPreviousTileForHover",()=>{this.previousTileForHover instanceof H&&(this.previousTileForHover.setTowerBp(null),this.previousTileForHover.updateBG()),this.previousTileForHover=null});e(this,"placeTowerOnTile",t=>{const i=m.menu.getSelectedTower();if(i===null)return;if(m.gold.getCurrentGold()<i.price){new tt("Not enough Gold!");return}const a=Pe(t);a instanceof H&&!a.hasTower&&(m.towers.createTower(a.x,a.y,i),m.gold.reduceGold(i.price),a.setHasTower(),a.setTowerBp(null),a.updateBG(),m.menu.setSelectedTower(null),h.body.removeAllClassesFromBody())});e(this,"showTowerRange",t=>{const i=Pe(t);if(i instanceof H&&i.hasTower&&m.menu.getSelectedTower()===null){const s=m.towers.getTowerForTile(i.x,i.y);s==null||s.setShowRange(!0)}});this.canvas=document.createElement("canvas"),this.canvas.id="canvas-game";const i=this.canvas.getContext("2d");if(i===null)throw new Error("Context not found");this.ctx=i,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.addEventListener("mousemove",this.mouseMoveCallback),this.canvas.addEventListener("mouseleave",this.mouseLeaveCallback),this.canvas.addEventListener("click",this.clickCallback),t.appendChild(this.canvas)}}class nt{constructor(){e(this,"body");e(this,"contextmenuCallback",t=>{t.preventDefault(),m.resetEventListeners()});e(this,"clickCallback",t=>{m.towers.hideTowerRange()});e(this,"mouseMoveCallback",t=>{this.showTowerMouseCursor(t)});e(this,"showTowerMouseCursor",t=>{const i=m.menu.getSelectedTower(),s=De(t);i!==null&&(s instanceof H&&s.towerBp===null||s===null)&&this.addTowerMouseCursor(i)});e(this,"addTowerMouseCursor",t=>{this.body.classList.add(t.id)});e(this,"removeAllClassesFromBody",()=>{this.body.className=""});const t=document.querySelector("body");if(t===null)throw new Error("Body not found");this.body=t,this.body.addEventListener("contextmenu",this.contextmenuCallback),this.body.addEventListener("click",this.clickCallback,!0),this.body.addEventListener("mousemove",this.mouseMoveCallback)}}class st{constructor(){e(this,"gameContainer");e(this,"guiContainer");e(this,"scaleInTransform",[{transform:"scale(0.9)"},{transform:"scale(1)"}]);e(this,"scaleInTiming",150);e(this,"getGuiContainer",()=>this.guiContainer);const t=document.getElementById("game-container");if(t===null)throw new Error("game-container not found");this.gameContainer=t,this.guiContainer=document.createElement("div"),this.guiContainer.id="gui-container",this.gameContainer.appendChild(this.guiContainer),this.guiContainer.animate(this.scaleInTransform,this.scaleInTiming)}}class at{constructor(t){e(this,"menuBorder");e(this,"menuContainer");e(this,"menuTowersContainer");e(this,"menuTowersContainerInner");e(this,"menuGameStatsContainer");e(this,"getMenuContainer",()=>this.menuContainer);e(this,"getMenuTowersContainer",()=>this.menuTowersContainer);e(this,"addChildToMenuTowersContainer",t=>{this.menuTowersContainerInner.appendChild(t)});e(this,"addMenuItemGold",t=>{this.menuGameStatsContainer.appendChild(t)});e(this,"addMenuItemPlayerHealth",t=>{this.menuGameStatsContainer.appendChild(t)});this.menuBorder=document.createElement("div"),this.menuBorder.id="menu-border",this.menuBorder.classList.add("box-shadow"),this.menuContainer=document.createElement("div"),this.menuContainer.id="menu-container",this.menuTowersContainer=document.createElement("div"),this.menuTowersContainer.id="menu-towers-container",this.menuTowersContainerInner=document.createElement("div"),this.menuTowersContainerInner.id="menu-towers-container-inner",this.menuGameStatsContainer=document.createElement("div"),this.menuGameStatsContainer.id="menu-game-stats-container",this.menuTowersContainer.appendChild(this.menuTowersContainerInner),this.menuBorder.appendChild(this.menuContainer),this.menuContainer.appendChild(this.menuGameStatsContainer),this.menuContainer.appendChild(this.menuTowersContainer),t.appendChild(this.menuBorder)}}class rt{constructor(){e(this,"toggleTilesInfoButton");e(this,"toggleGrid",()=>{M.drawGrid()});const t=document.querySelector("#toggle-tiles-info");if(t===null)throw new Error("toggleTilesInfoButton not found");this.toggleTilesInfoButton=t,this.toggleTilesInfoButton.addEventListener("click",this.toggleGrid)}}class ot{constructor(){e(this,"guiContainer");e(this,"canvasContainer");e(this,"canvasBackground");e(this,"canvasGame");e(this,"ctxBackground");e(this,"ctxGame");e(this,"menuContainer");e(this,"body");this.guiContainer=new st,this.canvasContainer=new et(this.guiContainer.getGuiContainer());const t=new _e(this.canvasContainer.getCanvasContainer());this.canvasBackground=t.getCanvas(),this.ctxBackground=t.getCtx();const i=new it(this.canvasContainer.getCanvasContainer());this.canvasGame=i.getCanvas(),this.ctxGame=i.getCtx(),this.menuContainer=new at(this.guiContainer.getGuiContainer()),new rt,this.body=new nt}}const S=(n,t)=>{const i=performance.now();return!n||i-n>=t};var Ce=(n=>(n.IDLE="idle",n.MOVE="move",n))(Ce||{}),C=(n=>(n.IDLE="idle",n.ATTACK="attack",n))(C||{}),u=(n=>(n.LEFT="left",n.RIGHT="right",n))(u||{}),P=(n=>(n.ARCANE_ARCHER="arcaneArcher",n.FIRE_MAGE="fireMage",n.Lightning_MAGE="lightningMage",n))(P||{}),ae=(n=>(n.ARCANE_ARCHER="arcaneArcherProjectile",n.FIRE_MAGE="fireMageProjectile",n.LIGHTNING_MAGE="lightningMageProjectile",n))(ae||{}),re=(n=>(n.ARCANE_ARCHER="arcaneArcherBp",n.FIRE_MAGE="fireMageBp",n.LIGHTNING_MAGE="lightningMageBp",n))(re||{}),oe=(n=>(n[n.WON=0]="WON",n[n.LOST=1]="LOST",n))(oe||{});class ht{constructor(){e(this,"currentEnemies",[]);e(this,"allEnemiesRemoved",!0);e(this,"updateEnemies",()=>{this.currentEnemies.forEach(t=>t.update())});e(this,"remove",t=>{this.currentEnemies=this.currentEnemies.filter(i=>i.id!==t)});e(this,"getCurrentEnemies",()=>this.currentEnemies);e(this,"setCurrentEnemies",t=>{this.currentEnemies=t,this.allEnemiesRemoved=!1});e(this,"update",()=>{this.updateEnemies(),this.currentEnemies.length===0&&(this.allEnemiesRemoved=!0)})}}const E=(n,t,i)=>{const s=document.createElement("p");s.classList.add("tower-stats-text");const a=document.createElement("span");if(a.innerHTML=t,s.appendChild(a),i!==void 0){const r=document.createElement("span");r.innerHTML=i,s.appendChild(r)}n.appendChild(s)};class lt{constructor(t,i){e(this,"container");e(this,"getContainer",()=>this.container);this.container=document.createElement("div"),this.container.classList.add("tower-stats-container","box-shadow","gold-info"),E(this.container,"Gold increase per round"),E(this.container,`+ ${t}% of current gold`),E(this.container,`+ ${i} static gold`),E(this.container,""),E(this.container,"Bounty gold per kill"),E(this.container,"Each kill grants a bounty gold. The bounty amount gets decreased for every corner waypoint the enemy has passed.")}}class Ne{constructor(t,i){e(this,"menuItem");e(this,"textElement");e(this,"update",t=>{this.textElement.innerText=t});e(this,"getElement",()=>this.menuItem);this.menuItem=document.createElement("div"),this.menuItem.classList.add("menu-item-stats"),this.menuItem.id=`menu-item-${t}`,this.textElement=document.createElement("span"),this.textElement.classList.add("menu-item-stats-content"),this.textElement.innerText=i,this.menuItem.appendChild(this.textElement),h.menuContainer.addMenuItemPlayerHealth(this.menuItem)}}class ct{constructor(){e(this,"menuItem");e(this,"startGold",100);e(this,"currentGold",this.startGold);e(this,"collectedBountyGoldPerRound",0);e(this,"percentageGoldIncreasePerRound",0);e(this,"infoScreen");e(this,"showInfoScreen",!1);e(this,"staticGoldIncrease",50);e(this,"percentageGoldIncrease",10);e(this,"reduceGold",t=>{this.currentGold-=t,this.update()});e(this,"increaseGoldAfterRound",()=>{this.percentageGoldIncreasePerRound=Math.round(this.percentageGoldIncrease/100*this.currentGold),this.currentGold=Math.round(this.currentGold+this.staticGoldIncrease+this.percentageGoldIncreasePerRound),this.update()});e(this,"increaseGoldAfterKillEnemy",t=>{this.collectedBountyGoldPerRound+=t,this.currentGold+=t,this.update()});e(this,"resetDynamicGoldIncreasePerRound",()=>{this.collectedBountyGoldPerRound=0,this.percentageGoldIncreasePerRound=0});e(this,"showInfo",()=>{this.showInfoScreen||(this.menuItem.getElement().appendChild(this.infoScreen.getContainer()),this.showInfoScreen=!0)});e(this,"removeInfo",()=>{this.menuItem.getElement().removeChild(this.infoScreen.getContainer()),this.showInfoScreen=!1});this.menuItem=new Ne("gold",this.currentGold.toString()),this.menuItem.getElement().addEventListener("mouseover",this.showInfo),this.menuItem.getElement().addEventListener("mouseleave",this.removeInfo),this.infoScreen=new lt(this.percentageGoldIncrease,this.staticGoldIncrease)}getCurrentGold(){return this.currentGold}getCollectedBountyGoldPerRound(){return this.collectedBountyGoldPerRound}getPercentageGoldIncreasePerRound(){return this.percentageGoldIncreasePerRound}update(){this.menuItem.update(this.currentGold.toString())}}class Ye{constructor({children:t,onTimeout:i,onClose:s,lifeTime:a}){e(this,"container");e(this,"closeButton");e(this,"lifeTime");e(this,"timeOutId");e(this,"onTimeout");e(this,"onClose");e(this,"scaleInTransformIn",[{transform:"translate(-50%, -50%) scale(0.5)"},{transform:"translate(-50%, -50%) scale(1)"}]);e(this,"scaleInTransformOut",[{transform:"translate(-50%, -50%) scale(1)"},{transform:"translate(-50%, -50%) scale(0.5)"}]);e(this,"scaleInTiming",100);e(this,"remove",()=>{this.container.animate(this.scaleInTransformOut,this.scaleInTiming),setTimeout(()=>{this.container.remove()},this.scaleInTiming)});this.lifeTime=a,this.onTimeout=i,this.onClose=s,this.container=document.createElement("div"),this.container.id="modal-pop-in-container",this.container.classList.add("box-shadow"),this.closeButton=document.createElement("button"),this.closeButton.id="modal-pop-in-container__close-button",this.closeButton.addEventListener("click",()=>{clearTimeout(this.timeOutId),this.remove(),this.onClose?this.onClose():this.onTimeout()}),this.container.appendChild(this.closeButton),this.container.appendChild(t),h.body.body.appendChild(this.container),this.container.animate(this.scaleInTransformIn,this.scaleInTiming),a&&(this.timeOutId=setTimeout(()=>{this.remove(),this.onTimeout()},this.lifeTime))}}class Ue{constructor(t){e(this,"endScreen");e(this,"headline");e(this,"resultElement");e(this,"result");e(this,"buttonContainer");e(this,"playButton");e(this,"wonText","You won!");e(this,"lostText","You lost all your lifes!");e(this,"scaleInTransform",[{transform:"translate(-50%, -50%) scale(0.5)"},{transform:"translate(-50%, -50%) scale(1)"}]);e(this,"scaleInTiming",100);this.result=t,this.endScreen=document.createElement("div"),this.headline=document.createElement("h2"),this.headline.id="end-screen-headline",this.headline.innerHTML="GAME OVER",this.resultElement=document.createElement("h2"),this.resultElement.id="end-screen-result",this.resultElement.innerHTML=this.result===oe.WON?this.wonText:this.lostText,this.buttonContainer=document.createElement("div"),this.buttonContainer.id="end-screen-button-container",this.playButton=document.createElement("button"),this.playButton.id="play-again-button",this.playButton.classList.add("box-shadow","play-button"),this.playButton.innerText="Play again",this.playButton.addEventListener("click",()=>location.reload()),this.buttonContainer.appendChild(this.playButton),this.endScreen.appendChild(this.headline),this.endScreen.appendChild(this.resultElement),this.endScreen.appendChild(this.buttonContainer),new Ye({children:this.endScreen,onTimeout:()=>location.reload()})}}class dt{constructor(t){e(this,"tower");e(this,"container");e(this,"getContainer",()=>this.container);this.tower=t,this.container=document.createElement("div"),this.container.classList.add("tower-stats-container","box-shadow"),E(this.container,t.config.name);const i=document.createElement("p");i.classList.add("tower-stats-description"),i.innerText=t.config.description,this.container.appendChild(i),E(this.container,"Damage:",t.config.damage.toString()),E(this.container,"Range:",t.config.range.toString()),E(this.container,"Attack speed:",t.config.attackSpeed.toString()),E(this.container,"Price:",t.price.toString())}}class mt{constructor(t,i){e(this,"tower");e(this,"container");e(this,"element");e(this,"innerElement");e(this,"selectTowerCallback");e(this,"showTowerStats",!1);e(this,"stats");e(this,"clickHandler",()=>{this.selectTowerCallback(this.tower)});e(this,"showStats",()=>{this.showTowerStats||(this.container.appendChild(this.stats.getContainer()),this.showTowerStats=!0)});e(this,"removeStats",()=>{this.container.removeChild(this.stats.getContainer()),this.showTowerStats=!1});this.tower=t,this.selectTowerCallback=i,this.container=document.createElement("div"),this.container.classList.add("menu-item-container"),this.element=document.createElement("div"),this.element.classList.add("menu-item-tower"),this.innerElement=document.createElement("div"),this.innerElement.classList.add("menu-item-tower__inner"),this.innerElement.id=t.id,this.element.addEventListener("click",this.clickHandler),this.container.addEventListener("mouseover",this.showStats),this.container.addEventListener("mouseleave",this.removeStats),this.element.appendChild(this.innerElement),this.container.appendChild(this.element),h.menuContainer.addChildToMenuTowersContainer(this.container),this.stats=new dt(this.tower)}}function ut(n){var t=n.default;if(typeof t=="function"){var i=function(){return t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var a=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(i,s,a.get?a:{enumerable:!0,get:function(){return n[s]}})}),i}var _,gt=new Uint8Array(16);function Ke(){if(!_&&(_=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!_))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _(gt)}const ft=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function he(n){return typeof n=="string"&&ft.test(n)}var g=[];for(var me=0;me<256;++me)g.push((me+256).toString(16).substr(1));function le(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=(g[n[t+0]]+g[n[t+1]]+g[n[t+2]]+g[n[t+3]]+"-"+g[n[t+4]]+g[n[t+5]]+"-"+g[n[t+6]]+g[n[t+7]]+"-"+g[n[t+8]]+g[n[t+9]]+"-"+g[n[t+10]]+g[n[t+11]]+g[n[t+12]]+g[n[t+13]]+g[n[t+14]]+g[n[t+15]]).toLowerCase();if(!he(i))throw TypeError("Stringified UUID is invalid");return i}var ke,ue,ge=0,fe=0;function wt(n,t,i){var s=t&&i||0,a=t||new Array(16);n=n||{};var r=n.node||ke,o=n.clockseq!==void 0?n.clockseq:ue;if(r==null||o==null){var l=n.random||(n.rng||Ke)();r==null&&(r=ke=[l[0]|1,l[1],l[2],l[3],l[4],l[5]]),o==null&&(o=ue=(l[6]<<8|l[7])&16383)}var c=n.msecs!==void 0?n.msecs:Date.now(),d=n.nsecs!==void 0?n.nsecs:fe+1,I=c-ge+(d-fe)/1e4;if(I<0&&n.clockseq===void 0&&(o=o+1&16383),(I<0||c>ge)&&n.nsecs===void 0&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");ge=c,fe=d,ue=o,c+=122192928e5;var x=((c&268435455)*1e4+d)%4294967296;a[s++]=x>>>24&255,a[s++]=x>>>16&255,a[s++]=x>>>8&255,a[s++]=x&255;var A=c/4294967296*1e4&268435455;a[s++]=A>>>8&255,a[s++]=A&255,a[s++]=A>>>24&15|16,a[s++]=A>>>16&255,a[s++]=o>>>8|128,a[s++]=o&255;for(var G=0;G<6;++G)a[s+G]=r[G];return t||le(a)}function Ve(n){if(!he(n))throw TypeError("Invalid UUID");var t,i=new Uint8Array(16);return i[0]=(t=parseInt(n.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=t&255,i[4]=(t=parseInt(n.slice(9,13),16))>>>8,i[5]=t&255,i[6]=(t=parseInt(n.slice(14,18),16))>>>8,i[7]=t&255,i[8]=(t=parseInt(n.slice(19,23),16))>>>8,i[9]=t&255,i[10]=(t=parseInt(n.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=t&255,i}function pt(n){n=unescape(encodeURIComponent(n));for(var t=[],i=0;i<n.length;++i)t.push(n.charCodeAt(i));return t}var Tt="6ba7b810-9dad-11d1-80b4-00c04fd430c8",It="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function ze(n,t,i){function s(a,r,o,l){if(typeof a=="string"&&(a=pt(a)),typeof r=="string"&&(r=Ve(r)),r.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+a.length);if(c.set(r),c.set(a,r.length),c=i(c),c[6]=c[6]&15|t,c[8]=c[8]&63|128,o){l=l||0;for(var d=0;d<16;++d)o[l+d]=c[d];return o}return le(c)}try{s.name=n}catch{}return s.DNS=Tt,s.URL=It,s}function vt(n){if(typeof n=="string"){var t=unescape(encodeURIComponent(n));n=new Uint8Array(t.length);for(var i=0;i<t.length;++i)n[i]=t.charCodeAt(i)}return Ct(xt(At(n),n.length*8))}function Ct(n){for(var t=[],i=n.length*32,s="0123456789abcdef",a=0;a<i;a+=8){var r=n[a>>5]>>>a%32&255,o=parseInt(s.charAt(r>>>4&15)+s.charAt(r&15),16);t.push(o)}return t}function qe(n){return(n+64>>>9<<4)+14+1}function xt(n,t){n[t>>5]|=128<<t%32,n[qe(t)-1]=t;for(var i=1732584193,s=-271733879,a=-1732584194,r=271733878,o=0;o<n.length;o+=16){var l=i,c=s,d=a,I=r;i=f(i,s,a,r,n[o],7,-680876936),r=f(r,i,s,a,n[o+1],12,-389564586),a=f(a,r,i,s,n[o+2],17,606105819),s=f(s,a,r,i,n[o+3],22,-1044525330),i=f(i,s,a,r,n[o+4],7,-176418897),r=f(r,i,s,a,n[o+5],12,1200080426),a=f(a,r,i,s,n[o+6],17,-1473231341),s=f(s,a,r,i,n[o+7],22,-45705983),i=f(i,s,a,r,n[o+8],7,1770035416),r=f(r,i,s,a,n[o+9],12,-1958414417),a=f(a,r,i,s,n[o+10],17,-42063),s=f(s,a,r,i,n[o+11],22,-1990404162),i=f(i,s,a,r,n[o+12],7,1804603682),r=f(r,i,s,a,n[o+13],12,-40341101),a=f(a,r,i,s,n[o+14],17,-1502002290),s=f(s,a,r,i,n[o+15],22,1236535329),i=w(i,s,a,r,n[o+1],5,-165796510),r=w(r,i,s,a,n[o+6],9,-1069501632),a=w(a,r,i,s,n[o+11],14,643717713),s=w(s,a,r,i,n[o],20,-373897302),i=w(i,s,a,r,n[o+5],5,-701558691),r=w(r,i,s,a,n[o+10],9,38016083),a=w(a,r,i,s,n[o+15],14,-660478335),s=w(s,a,r,i,n[o+4],20,-405537848),i=w(i,s,a,r,n[o+9],5,568446438),r=w(r,i,s,a,n[o+14],9,-1019803690),a=w(a,r,i,s,n[o+3],14,-187363961),s=w(s,a,r,i,n[o+8],20,1163531501),i=w(i,s,a,r,n[o+13],5,-1444681467),r=w(r,i,s,a,n[o+2],9,-51403784),a=w(a,r,i,s,n[o+7],14,1735328473),s=w(s,a,r,i,n[o+12],20,-1926607734),i=p(i,s,a,r,n[o+5],4,-378558),r=p(r,i,s,a,n[o+8],11,-2022574463),a=p(a,r,i,s,n[o+11],16,1839030562),s=p(s,a,r,i,n[o+14],23,-35309556),i=p(i,s,a,r,n[o+1],4,-1530992060),r=p(r,i,s,a,n[o+4],11,1272893353),a=p(a,r,i,s,n[o+7],16,-155497632),s=p(s,a,r,i,n[o+10],23,-1094730640),i=p(i,s,a,r,n[o+13],4,681279174),r=p(r,i,s,a,n[o],11,-358537222),a=p(a,r,i,s,n[o+3],16,-722521979),s=p(s,a,r,i,n[o+6],23,76029189),i=p(i,s,a,r,n[o+9],4,-640364487),r=p(r,i,s,a,n[o+12],11,-421815835),a=p(a,r,i,s,n[o+15],16,530742520),s=p(s,a,r,i,n[o+2],23,-995338651),i=T(i,s,a,r,n[o],6,-198630844),r=T(r,i,s,a,n[o+7],10,1126891415),a=T(a,r,i,s,n[o+14],15,-1416354905),s=T(s,a,r,i,n[o+5],21,-57434055),i=T(i,s,a,r,n[o+12],6,1700485571),r=T(r,i,s,a,n[o+3],10,-1894986606),a=T(a,r,i,s,n[o+10],15,-1051523),s=T(s,a,r,i,n[o+1],21,-2054922799),i=T(i,s,a,r,n[o+8],6,1873313359),r=T(r,i,s,a,n[o+15],10,-30611744),a=T(a,r,i,s,n[o+6],15,-1560198380),s=T(s,a,r,i,n[o+13],21,1309151649),i=T(i,s,a,r,n[o+4],6,-145523070),r=T(r,i,s,a,n[o+11],10,-1120210379),a=T(a,r,i,s,n[o+2],15,718787259),s=T(s,a,r,i,n[o+9],21,-343485551),i=b(i,l),s=b(s,c),a=b(a,d),r=b(r,I)}return[i,s,a,r]}function At(n){if(n.length===0)return[];for(var t=n.length*8,i=new Uint32Array(qe(t)),s=0;s<t;s+=8)i[s>>5]|=(n[s/8]&255)<<s%32;return i}function b(n,t){var i=(n&65535)+(t&65535),s=(n>>16)+(t>>16)+(i>>16);return s<<16|i&65535}function Et(n,t){return n<<t|n>>>32-t}function ce(n,t,i,s,a,r){return b(Et(b(b(t,n),b(s,r)),a),i)}function f(n,t,i,s,a,r,o){return ce(t&i|~t&s,n,t,a,r,o)}function w(n,t,i,s,a,r,o){return ce(t&s|i&~s,n,t,a,r,o)}function p(n,t,i,s,a,r,o){return ce(t^i^s,n,t,a,r,o)}function T(n,t,i,s,a,r,o){return ce(i^(t|~s),n,t,a,r,o)}var yt=ze("v3",48,vt);const St=yt;function Gt(n,t,i){n=n||{};var s=n.random||(n.rng||Ke)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){i=i||0;for(var a=0;a<16;++a)t[i+a]=s[a];return t}return le(s)}function Mt(n,t,i,s){switch(n){case 0:return t&i^~t&s;case 1:return t^i^s;case 2:return t&i^t&s^i&s;case 3:return t^i^s}}function we(n,t){return n<<t|n>>>32-t}function Ht(n){var t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var s=unescape(encodeURIComponent(n));n=[];for(var a=0;a<s.length;++a)n.push(s.charCodeAt(a))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var r=n.length/4+2,o=Math.ceil(r/16),l=new Array(o),c=0;c<o;++c){for(var d=new Uint32Array(16),I=0;I<16;++I)d[I]=n[c*64+I*4]<<24|n[c*64+I*4+1]<<16|n[c*64+I*4+2]<<8|n[c*64+I*4+3];l[c]=d}l[o-1][14]=(n.length-1)*8/Math.pow(2,32),l[o-1][14]=Math.floor(l[o-1][14]),l[o-1][15]=(n.length-1)*8&4294967295;for(var x=0;x<o;++x){for(var A=new Uint32Array(80),G=0;G<16;++G)A[G]=l[x][G];for(var B=16;B<80;++B)A[B]=we(A[B-3]^A[B-8]^A[B-14]^A[B-16],1);for(var q=i[0],J=i[1],Q=i[2],Z=i[3],de=i[4],$=0;$<80;++$){var Be=Math.floor($/20),Qe=we(q,5)+Mt(Be,J,Q,Z)+de+t[Be]+A[$]>>>0;de=Z,Z=Q,Q=we(J,30)>>>0,J=q,q=Qe}i[0]=i[0]+q>>>0,i[1]=i[1]+J>>>0,i[2]=i[2]+Q>>>0,i[3]=i[3]+Z>>>0,i[4]=i[4]+de>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,i[0]&255,i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,i[1]&255,i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,i[2]&255,i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,i[3]&255,i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,i[4]&255]}var bt=ze("v5",80,Ht);const Bt=bt,Pt="00000000-0000-0000-0000-000000000000";function kt(n){if(!he(n))throw TypeError("Invalid UUID");return parseInt(n.substr(14,1),16)}const Rt=Object.freeze(Object.defineProperty({__proto__:null,v1:wt,v3:St,v4:Gt,v5:Bt,NIL:Pt,version:kt,validate:he,stringify:le,parse:Ve},Symbol.toStringTag,{value:"Module"})),Ft=ut(Rt);function Ae(n,t){if(!n||!t||!n.length||!t.length)throw new Error("Bad alphabet");this.srcAlphabet=n,this.dstAlphabet=t}Ae.prototype.convert=function(n){var t,i,s,a={},r=this.srcAlphabet.length,o=this.dstAlphabet.length,l=n.length,c=typeof n=="string"?"":[];if(!this.isValid(n))throw new Error('Number "'+n+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return n;for(t=0;t<l;t++)a[t]=this.srcAlphabet.indexOf(n[t]);do{for(i=0,s=0,t=0;t<l;t++)i=i*r+a[t],i>=o?(a[s++]=parseInt(i/o,10),i=i%o):s>0&&(a[s++]=0);l=s,c=this.dstAlphabet.slice(i,i+1).concat(c)}while(s!==0);return c};Ae.prototype.isValid=function(n){for(var t=0;t<n.length;++t)if(this.srcAlphabet.indexOf(n[t])===-1)return!1;return!0};var Lt=Ae,Ot=Lt;function V(n,t){var i=new Ot(n,t);return function(s){return i.convert(s)}}V.BIN="01";V.OCT="01234567";V.DEC="0123456789";V.HEX="0123456789abcdef";var Dt=V;const{v4:pe}=Ft,ee=Dt,Te="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ",Wt="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#$%&'()*+-./:<=>?@[]^_`{|}~",Xt={consistentLength:!0};let Ie;const Re=(n,t,i)=>{const s=t(n.toLowerCase().replace(/-/g,""));return!i||!i.consistentLength?s:s.padStart(i.shortIdLength,i.paddingChar)},jt=(n,t)=>{const s=t(n).padStart(32,"0").match(/(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})/);return[s[1],s[2],s[3],s[4],s[5]].join("-")},Nt=n=>Math.ceil(Math.log(2**128)/Math.log(n));var y=(()=>{const n=(t,i)=>{const s=t||Te,a={...Xt,...i};if([...new Set(Array.from(s))].length!==s.length)throw new Error("The provided Alphabet has duplicate characters resulting in unreliable results");const r=Nt(s.length),o={shortIdLength:r,consistentLength:a.consistentLength,paddingChar:s[0]},l=ee(ee.HEX,s),c=ee(s,ee.HEX),d=()=>Re(pe(),l,o),I={new:d,generate:d,uuid:pe,fromUUID:x=>Re(x,l,o),toUUID:x=>jt(x,c),alphabet:s,maxLength:r};return Object.freeze(I),I};return n.constants={flickrBase58:Te,cookieBase90:Wt},n.uuid=pe,n.generate=()=>(Ie||(Ie=n(Te).generate),Ie()),n})();const Fe=(n,t)=>Math.hypot(n.x-t.x,n.y-t.y);class Ee{constructor(t,i,s,a){e(this,"id");e(this,"x");e(this,"y");e(this,"tileMiddle");e(this,"range");e(this,"attackSpeed");e(this,"attackSpeedThrottleTime");e(this,"image");e(this,"sWidth");e(this,"sHeight");e(this,"dWidth");e(this,"dHeight");e(this,"imageTranslateX");e(this,"imageTranslateY");e(this,"imgConfig");e(this,"frameIteration",0);e(this,"frameIterationThrottleTime",100);e(this,"cancelAttackAnimantionAllowed");e(this,"projectileImg");e(this,"projectileWidth");e(this,"projectileHeight");e(this,"projectiles",[]);e(this,"state",C.IDLE);e(this,"animationDirection",u.LEFT);e(this,"showRange",!1);e(this,"updateImgConfig",!1);e(this,"newAnimationCycle",!0);e(this,"sX",null);e(this,"sY",null);e(this,"frames",null);e(this,"flipOffsetFrames",null);e(this,"lastFrameIteration",null);e(this,"lastAttack",null);e(this,"currentTarget",null);e(this,"targetFallbackCoordinates",null);e(this,"getImgConfigForState",()=>{let t;switch(this.state){case C.IDLE:t=this.imgConfig.idle;break;default:t=this.imgConfig.attack}return t});e(this,"setImageConfig",()=>{const{animationStartRight:t,animationStartLeft:i,frames:s,animationIterationCircleTime:a,flipOffsetFrames:r}=this.getImgConfigForState();this.sX=this.animationDirection===u.RIGHT?t.sx:i.sx,this.sY=this.animationDirection===u.RIGHT?t.sy:i.sy,this.frames=s,this.flipOffsetFrames=r,this.frameIterationThrottleTime=a/this.frames});e(this,"setSxFrame",()=>{if(this.frames===null||this.flipOffsetFrames===null)throw new Error("Frames or flipOffsetFrames is null");this.animationDirection===u.RIGHT?this.sX=this.frameIteration*this.sWidth:this.sX=(this.frames+this.flipOffsetFrames)*this.sWidth-(this.frameIteration+1)*this.sWidth});e(this,"shoot",()=>{this.lastAttack=performance.now()});e(this,"setFrameIteration",()=>{if(this.frames===null)throw new Error("Frames is null");this.frameIteration<this.frames-1?this.frameIteration++:(this.frameIteration=0,this.newAnimationCycle=!0,this.state===C.ATTACK&&(this.state=C.IDLE,this.setImageConfig(),this.targetFallbackCoordinates=null))});e(this,"drawImg",()=>{this.sX!==null&&this.sY!==null&&h.ctxGame.drawImage(this.image,this.sX,this.sY,this.sWidth,this.sHeight,this.x+this.imageTranslateX,this.y+this.imageTranslateY,this.dWidth,this.dHeight)});e(this,"idleAnimation",()=>{this.drawImg()});e(this,"setStateAndCurrentTarget",t=>{this.currentTarget=t,!(t===null&&this.state===C.ATTACK&&!this.cancelAttackAnimantionAllowed)&&(this.newAnimationCycle=!0,this.frameIteration=0,t===null?(this.state=C.IDLE,this.setImageConfig()):(this.targetFallbackCoordinates={x:t.x,y:t.y},this.state=C.ATTACK,this.setAnimationDirection(),this.setImageConfig()))});e(this,"findNextTarget",()=>{let t=null,i=1/0;return m.enemies.getCurrentEnemies().forEach(s=>{const a=Fe(this.tileMiddle,{x:s.x,y:s.y});a<=this.range&&a<=i&&(i=a,t=s)}),t});e(this,"checkAndSetClosestEnemyInRange",()=>{if(this.currentTargetIsInRage())this.setStateAndCurrentTarget(this.currentTarget);else{const t=this.findNextTarget();t!==null&&this.setStateAndCurrentTarget(t)}});e(this,"currentTargetIsInRage",()=>this.currentTarget?!(Fe(this.tileMiddle,{x:this.currentTarget.x,y:this.currentTarget.y})>this.range):!1);e(this,"setAnimationDirection",()=>{if(this.currentTarget===null)throw new Error("No current target");this.currentTarget.x<=this.x?this.animationDirection===u.RIGHT&&(this.animationDirection=u.LEFT,this.updateImgConfig=!0):this.animationDirection===u.LEFT&&(this.animationDirection=u.RIGHT,this.updateImgConfig=!0)});e(this,"attackAnimation",()=>{this.drawImg()});e(this,"updateProjectiles",()=>{this.projectiles.forEach(t=>t.update())});e(this,"removeProjectile",t=>{this.projectiles=this.projectiles.filter(i=>i.id!==t)});e(this,"removeTarget",()=>{this.setStateAndCurrentTarget(null)});e(this,"drawRange",()=>{h.ctxGame.beginPath(),h.ctxGame.arc(this.tileMiddle.x,this.tileMiddle.y,this.range,0,Math.PI*2),h.ctxGame.fillStyle="rgba(225,225,225,0.1)",h.ctxGame.fill()});e(this,"setShowRange",t=>{this.showRange=t});e(this,"shootAtAttackAnimationFrame",(t,i)=>{S(this.lastAttack,this.attackSpeedThrottleTime)&&this.frameIteration===t&&(this.shoot(),this.projectiles.push(i()))});e(this,"updateFrames",()=>{this.newAnimationCycle===!0?(this.setSxFrame(),this.lastFrameIteration=performance.now(),this.newAnimationCycle=!1):S(this.lastFrameIteration,this.frameIterationThrottleTime)&&(this.setFrameIteration(),this.setSxFrame(),this.lastFrameIteration=performance.now())});this.id=t,this.x=i,this.y=s,this.tileMiddle=Xe({x:i,y:s}),this.range=a.range,this.attackSpeed=a.attackSpeed,this.attackSpeedThrottleTime=60/this.attackSpeed*1e3,this.cancelAttackAnimantionAllowed=a.cancelAttackAnimantionAllowed,this.image=Y.imageController.getImage(a.id),this.sWidth=a.sWidth,this.sHeight=a.sHeight,this.dWidth=a.imageScale*a.sWidth,this.dHeight=a.imageScale*a.sHeight,this.imageTranslateX=ie({imageScale:a.imageScale,sourceSize:a.sWidth,translateCorrection:a.imageTranslateCorrection.x}),this.imageTranslateY=ie({imageScale:a.imageScale,sourceSize:a.sHeight,translateCorrection:a.imageTranslateCorrection.y}),this.imgConfig=a.frameConfig,this.setImageConfig(),this.projectileImg=Y.imageController.getImage(a.projectile.id),this.projectileWidth=a.projectile.width,this.projectileHeight=a.projectile.height}}const K=(n,t,i,s)=>{const a=s-t,r=i-n;let o=Math.atan2(a,r);return o*=180/Math.PI,o},xe=({center:n,radius:t,target:i})=>Math.sqrt(Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2))<=t;class Yt{constructor(t,i,s,a,r,o){e(this,"id");e(this,"x");e(this,"y");e(this,"radius");e(this,"damage");e(this,"damageOverTimeThrottleTime");e(this,"affectedEnemies",[]);e(this,"isAffectedEnemy",t=>this.affectedEnemies.find(i=>i.enemy===t));e(this,"updateEnemiesInsideArea",()=>{m.enemies.getCurrentEnemies().forEach(t=>{if(xe({center:{x:this.x,y:this.y},radius:this.radius,target:{x:t.x,y:t.y}})&&!this.isAffectedEnemy(t))this.affectedEnemies.push({enemy:t,damageHitTime:null});else if(!xe({center:{x:this.x,y:this.y},radius:this.radius,target:{x:t.x,y:t.y}})&&this.isAffectedEnemy(t)){const i=this.affectedEnemies.map(s=>s.enemy).indexOf(t);this.affectedEnemies.splice(i,1)}}),this.affectedEnemies.forEach(t=>{if(!m.enemies.getCurrentEnemies().includes(t.enemy)){const i=this.affectedEnemies.indexOf(t);this.affectedEnemies.splice(i,1)}})});e(this,"damageEnemies",()=>{this.affectedEnemies.forEach(t=>{(t.damageHitTime===null||S(t.damageHitTime,this.damageOverTimeThrottleTime))&&(t.enemy.reduceHealth(this.damage),t.damageHitTime=performance.now())})});e(this,"update",()=>{this.updateEnemiesInsideArea(),this.damageEnemies()});this.id=t,this.x=i,this.y=s,this.radius=a,this.damage=r,this.damageOverTimeThrottleTime=o}}class Ut{constructor(t,i,s,a,r,o,l,c,d){e(this,"id");e(this,"x");e(this,"y");e(this,"damage");e(this,"duration");e(this,"image");e(this,"sWidth",74);e(this,"sHeight",44);e(this,"dWidth",74);e(this,"dHeight",44);e(this,"sY",0);e(this,"target");e(this,"animationDirection");e(this,"angle");e(this,"removeProjectile");e(this,"damageOverTimeArea");e(this,"damageOverTimeThrottleTime",400);e(this,"damageOverTimeRadius",20);e(this,"frameIteration",0);e(this,"frames",8);e(this,"sX",null);e(this,"frameIterationThrottleTime");e(this,"lastFrameIteration",null);e(this,"setFrameIteration",()=>{this.frameIteration++});e(this,"setSxFrame",()=>{this.animationDirection===u.RIGHT?this.sX=this.frameIteration*this.sWidth:this.sX=this.frames*this.sWidth-(this.frameIteration+1)*this.sWidth});e(this,"getHandPosition",()=>this.animationDirection===u.RIGHT?[this.x+20,this.y-5]:[this.x-20,this.y-5]);e(this,"draw",()=>{if(this.sX===null||this.sY===null)throw new Error("sX or sY is null");if(this.frameIteration===this.frames)throw new Error("frameIteration is equal to frames");h.ctxGame.save(),h.ctxGame.translate(...this.getHandPosition()),h.ctxGame.rotate(this.angle*(Math.PI/180)),h.ctxGame.drawImage(this.image,this.sX,this.sY,this.sWidth,this.sHeight,0,-25,this.dWidth,this.dHeight),h.ctxGame.restore()});e(this,"updatedamageOverTimeArea",()=>{this.damageOverTimeArea.update()});e(this,"updateFrames",()=>{if(this.lastFrameIteration===null)this.setSxFrame(),this.lastFrameIteration=performance.now();else if(S(this.lastFrameIteration,this.frameIterationThrottleTime)){if(this.setFrameIteration(),this.frameIteration===this.frames)return this.removeProjectile(this.id),!1;this.setSxFrame(),this.lastFrameIteration=performance.now()}return!0});e(this,"update",()=>{this.updateFrames()!==!1&&(this.draw(),this.updatedamageOverTimeArea())});this.id=t,this.x=i,this.y=s,this.damage=a,this.duration=r,this.frameIterationThrottleTime=this.duration/this.frames,this.image=o,this.target=l,this.animationDirection=c,this.angle=K(this.x,this.y,this.target.x,this.target.y),this.removeProjectile=d,this.damageOverTimeArea=new Yt(y.generate(),this.target.x,this.target.y,this.damageOverTimeRadius,this.damage,this.damageOverTimeThrottleTime)}}const Le=800,U=class extends Ee{constructor(i,s,a){super(i,s,a,U.config);e(this,"getProjectile",()=>{if(this.targetFallbackCoordinates===null)throw new Error("No current target");return new Ut(y.generate(),this.tileMiddle.x,this.tileMiddle.y,U.config.damage,U.config.frameConfig.attack.animationIterationCircleTime,this.projectileImg,this.currentTarget||this.targetFallbackCoordinates,this.animationDirection,this.removeProjectile)});e(this,"update",()=>{this.updateFrames(),this.state===C.ATTACK&&(this.attackAnimation(),this.shootAtAttackAnimationFrame(0,()=>this.getProjectile())),this.state===C.IDLE&&(this.idleAnimation(),S(this.lastAttack,this.attackSpeedThrottleTime)&&this.checkAndSetClosestEnemyInRange()),this.showRange&&this.drawRange(),this.updateProjectiles()})}};let F=U;e(F,"config",{id:P.FIRE_MAGE,name:"Fire Mage",description:`Burns a small area for ${Le/1e3}sec. Slow enemies can get multiple damage ticks.`,range:100,attackSpeed:40,damage:20,sWidth:64,sHeight:64,imageScale:1,imageTranslateCorrection:{x:0,y:0},frameConfig:{idle:{frames:4,animationIterationCircleTime:500,flipOffsetFrames:0,animationStartRight:{sx:0,sy:0},animationStartLeft:{sx:448,sy:128}},attack:{frames:4,animationIterationCircleTime:Le,flipOffsetFrames:0,animationStartRight:{sx:0,sy:64},animationStartLeft:{sx:448,sy:192}}},cancelAttackAnimantionAllowed:!1,projectile:{id:ae.FIRE_MAGE,width:40,height:5},bluePrint:{id:re.FIRE_MAGE}});const Je=({x:n,y:t},{x:i,y:s})=>(n-i-1)*(n-i+1)<=0&&(t-s-1)*(t-s+1)<=0;class Kt{constructor(t,i,s,a,{img:r,width:o,height:l},c,d){e(this,"id");e(this,"x");e(this,"y");e(this,"damage");e(this,"targetEnemy");e(this,"removeProjectile");e(this,"speed",20);e(this,"image");e(this,"width");e(this,"height");e(this,"draw",()=>{const t=K(this.x,this.y,this.targetEnemy.x,this.targetEnemy.y);h.ctxGame.save(),h.ctxGame.translate(this.x,this.y),h.ctxGame.rotate(t*(Math.PI/180)),h.ctxGame.drawImage(this.image,-this.width,-this.height),h.ctxGame.restore()});e(this,"move",()=>{const t=K(this.x,this.y,this.targetEnemy.x,this.targetEnemy.y),i=Math.abs(this.targetEnemy.x-this.x);i-this.speed<0?this.x+=i*Math.cos(t*Math.PI/180):this.x+=this.speed*Math.cos(t*Math.PI/180);const s=Math.abs(this.targetEnemy.y-this.y);s-this.speed<0?this.y+=s*Math.sin(t*Math.PI/180):this.y+=this.speed*Math.sin(t*Math.PI/180),Je({x:this.x,y:this.y},{x:this.targetEnemy.x,y:this.targetEnemy.y})&&this.collide()});e(this,"collide",()=>{this.removeProjectile(this.id),this.targetEnemy.reduceHealth(this.damage)});e(this,"update",()=>{this.move(),this.draw()});this.id=t,this.x=i,this.y=s,this.damage=a,this.image=r,this.width=o,this.height=l,this.targetEnemy=c,this.removeProjectile=d}}const ne=class extends Ee{constructor(i,s,a){super(i,s,a,ne.config);e(this,"getProjectile",()=>{if(this.currentTarget===null)throw new Error("No current target");return new Kt(y.generate(),this.tileMiddle.x,this.tileMiddle.y,ne.config.damage,{img:this.projectileImg,width:this.projectileWidth,height:this.projectileHeight},this.currentTarget,this.removeProjectile)});e(this,"update",()=>{this.updateFrames(),this.state===C.ATTACK&&(this.attackAnimation(),this.shootAtAttackAnimationFrame(6,()=>this.getProjectile())),this.state===C.IDLE&&(this.idleAnimation(),S(this.lastAttack,this.attackSpeedThrottleTime)&&this.checkAndSetClosestEnemyInRange()),this.showRange&&this.drawRange(),this.updateProjectiles()})}};let L=ne;e(L,"config",{id:P.ARCANE_ARCHER,name:"Arcane Archer",description:"Shoots a magic arrow that deals damage to a single enemy.",range:250,attackSpeed:100,damage:5,sWidth:64,sHeight:64,imageScale:1.1,imageTranslateCorrection:{x:0,y:5},frameConfig:{idle:{frames:4,animationIterationCircleTime:600,flipOffsetFrames:4,animationStartRight:{sx:0,sy:320},animationStartLeft:{sx:448,sy:832}},attack:{frames:7,animationIterationCircleTime:400,flipOffsetFrames:1,animationStartRight:{sx:0,sy:192},animationStartLeft:{sx:448,sy:704}}},cancelAttackAnimantionAllowed:!0,projectile:{id:ae.ARCANE_ARCHER,width:40,height:5},bluePrint:{id:re.ARCANE_ARCHER}});class Vt{constructor(t,i,s,a,r){e(this,"id");e(this,"x");e(this,"y");e(this,"radius");e(this,"damage");e(this,"enemiesInsideArea",[]);e(this,"setEnemiesInsideArea",()=>{this.enemiesInsideArea=m.enemies.getCurrentEnemies().filter(t=>xe({center:{x:this.x,y:this.y},radius:this.radius,target:{x:t.x,y:t.y}}))});e(this,"damageEnemiesInsideArea",()=>{this.enemiesInsideArea.forEach(t=>{t.reduceHealth(this.damage)})});e(this,"getEnemiesInsideArea",()=>this.enemiesInsideArea);this.id=t,this.x=i,this.y=s,this.radius=a,this.damage=r,this.setEnemiesInsideArea(),this.damageEnemiesInsideArea()}}class zt{constructor(t,i){e(this,"id");e(this,"slowStart");e(this,"slowPercentage");e(this,"slowDuration");this.id=y.generate(),this.slowStart=performance.now(),this.slowPercentage=t,this.slowDuration=i}}class qt extends Vt{constructor(i,s,a,r,o){super(i,s,a,r,o);e(this,"slowEnemiesInsideArea",()=>{this.getEnemiesInsideArea().forEach(i=>{i.addSlow(new zt(30,2e3))})});this.slowEnemiesInsideArea()}}class Jt{constructor(t,i,s,a,r,o,l){e(this,"id");e(this,"x");e(this,"y");e(this,"damage");e(this,"image");e(this,"sWidth",150);e(this,"sHeight",192);e(this,"dWidth",150);e(this,"dHeight",192);e(this,"sY",0);e(this,"dX");e(this,"dY");e(this,"removeProjectile");e(this,"radius",70);e(this,"frameIteration",0);e(this,"frames",7);e(this,"animationIterationCircleTime",600);e(this,"sX",null);e(this,"frameIterationThrottleTime",this.animationIterationCircleTime/this.frames);e(this,"lastFrameIteration",null);e(this,"setFrameIteration",()=>{this.frameIteration++});e(this,"setSxFrame",()=>{this.sX=this.frameIteration*this.sWidth});e(this,"draw",()=>{if(this.sX===null||this.sY===null)throw new Error("sX or sY is null");if(this.frameIteration===this.frames)throw new Error("frameIteration is equal to frames");h.ctxGame.drawImage(this.image,this.sX,this.sY,this.sWidth,this.sHeight,this.dX-this.dWidth/2,this.dY-this.dHeight/1.35,this.dWidth,this.dHeight)});e(this,"updateFrames",()=>{if(this.lastFrameIteration===null)this.setSxFrame(),this.lastFrameIteration=performance.now();else if(S(this.lastFrameIteration,this.frameIterationThrottleTime)){if(this.setFrameIteration(),this.frameIteration===this.frames)return this.removeProjectile(this.id),!1;this.setSxFrame(),this.lastFrameIteration=performance.now()}return!0});e(this,"update",()=>{this.updateFrames()!==!1&&this.draw()});this.id=t,this.x=i,this.y=s,this.damage=a,this.image=r,this.dX=o.x,this.dY=o.y,this.removeProjectile=l,new qt(y.generate(),this.dX,this.dY,this.radius,this.damage)}}const se=class extends Ee{constructor(i,s,a){super(i,s,a,se.config);e(this,"getProjectile",()=>{if(this.targetFallbackCoordinates===null)throw new Error("No current target");return new Jt(y.generate(),this.tileMiddle.x,this.tileMiddle.y,se.config.damage,this.projectileImg,this.currentTarget||this.targetFallbackCoordinates,this.removeProjectile)});e(this,"update",()=>{this.updateFrames(),this.state===C.ATTACK&&(this.attackAnimation(),this.shootAtAttackAnimationFrame(10,()=>this.getProjectile())),this.state===C.IDLE&&(this.idleAnimation(),S(this.lastAttack,this.attackSpeedThrottleTime)&&this.checkAndSetClosestEnemyInRange()),this.showRange&&this.drawRange(),this.updateProjectiles()})}};let O=se;e(O,"config",{id:P.Lightning_MAGE,name:"Lightning Mage",description:"Summons a lightning bolt to damage and slow enemies for 30% in an area.",range:200,attackSpeed:30,damage:10,sWidth:64,sHeight:64,imageScale:1.2,imageTranslateCorrection:{x:0,y:-5},frameConfig:{idle:{frames:8,animationIterationCircleTime:800,flipOffsetFrames:8,animationStartRight:{sx:0,sy:0},animationStartLeft:{sx:960,sy:128}},attack:{frames:16,animationIterationCircleTime:1e3,flipOffsetFrames:0,animationStartRight:{sx:0,sy:64},animationStartLeft:{sx:960,sy:192}}},cancelAttackAnimantionAllowed:!1,projectile:{id:ae.LIGHTNING_MAGE,width:40,height:5},bluePrint:{id:re.LIGHTNING_MAGE}});const ye=class{constructor(){e(this,"selectedTower",null);e(this,"getSelectedTower",()=>this.selectedTower);e(this,"setSelectedTower",t=>{this.selectedTower=t});e(this,"selectTower",t=>{this.setSelectedTower(t),h.body.removeAllClassesFromBody(),t!==null&&h.body.addTowerMouseCursor(t)});ye.towers.forEach(t=>{new mt(t,this.selectTower)})}};let te=ye;e(te,"towers",[{id:L.config.id,config:L.config,price:40},{id:O.config.id,config:O.config,price:100},{id:F.config.id,config:F.config,price:120}]);class Qt{constructor(){e(this,"startHealth",100);e(this,"currentHealth",this.startHealth);e(this,"menuItem");e(this,"getCurrentHealth",()=>this.currentHealth);e(this,"reduceHealth",(t=5)=>{this.currentHealth-=t,this.update()});e(this,"update",()=>{this.menuItem.update(this.currentHealth.toString())});this.menuItem=new Ne("health",this.currentHealth.toString())}}class Zt{constructor({name:t,health:i,bountyGold:s,speed:a,maxSlowPercentage:r,special:o}){e(this,"container");e(this,"getContainer",()=>this.container);e(this,"createInfo",t=>{const i=document.createElement("p");i.innerText=t,this.container.appendChild(i)});e(this,"createStats",(t,i)=>{const s=document.createElement("p");s.classList.add("enemy-stats-text");const a=document.createElement("span");a.classList.add("enemy-stats-key"),a.innerText=t,s.appendChild(a);const r=document.createElement("span");r.innerText=i,s.appendChild(r),this.container.appendChild(s)});this.container=document.createElement("div"),this.container.id="spawn-enemies-container";const l=document.createElement("h2");l.id="spawn-enemies-headline",l.innerText="Next Wave",this.container.appendChild(l),this.createInfo(t),o&&this.createInfo(`Special: ${o.description}`),this.createStats("Health:",i.toString()),this.createStats("Bounty Gold:",s.toString()),this.createStats("Speed:",a.toString()),this.createStats("Max slow:",`${r.toString()}%`)}}class $t{constructor(t){e(this,"countdownElement");e(this,"countdownTime");e(this,"getContainer",()=>this.countdownElement);e(this,"getCountdownTime",()=>this.countdownTime);e(this,"startCountdown",()=>{const t=setInterval(()=>{this.countdownTime--,this.countdownElement.innerText=this.countdownTime.toString(),this.countdownTime===0&&clearInterval(t)},1e3)});this.countdownTime=t,this.countdownElement=document.createElement("p"),this.countdownElement.id="countdown",this.countdownElement.innerText=this.countdownTime.toString(),this.startCountdown()}}class _t{constructor({children:t}){e(this,"container");e(this,"scaleInTransformOut",[{transform:"translateX(0)"},{transform:"translateX(-100%)"}]);e(this,"scaleInTimingOut",300);e(this,"scaleInTransformIn",[{transform:"translateX(-100%)"},{transform:"translateX(0)"}]);e(this,"scaleInTimingIn",300);e(this,"close",()=>{this.container.animate(this.scaleInTransformOut,this.scaleInTimingOut),setTimeout(()=>{this.container.remove()},this.scaleInTimingOut)});this.container=document.createElement("div"),this.container.id="toast",this.container.classList.add("box-shadow"),this.container.appendChild(t),document.body.appendChild(this.container),this.container.animate(this.scaleInTransformIn,this.scaleInTimingIn)}}class ei{constructor(t){e(this,"game");e(this,"waveIsScheduled",!1);e(this,"modalLifeTime",1e4);e(this,"spawnEnemies",()=>{const{currentEnemies:t,config:i}=this.game.waves.createEnemyWave(),s=()=>{this.game.enemies.setCurrentEnemies(t),this.waveIsScheduled=!1,this.game.gold.resetDynamicGoldIncreasePerRound()},a=new Zt(i).getContainer(),r=new $t(this.modalLifeTime/1e3);a.appendChild(r.getContainer());const o=()=>{const l=new _t({children:r.getContainer()}),c=setInterval(()=>{r.getCountdownTime()===0&&(l.close(),s(),clearInterval(c))},100)};new Ye({children:a,onTimeout:s,onClose:o,lifeTime:this.modalLifeTime})});e(this,"update",()=>{if(!this.waveIsScheduled&&this.game.enemies.allEnemiesRemoved){if(this.game.waves.wasLastWave){this.game.stopGame(),new Ue(oe.WON);return}this.game.waves.waveIndex>0&&this.game.gold.increaseGoldAfterRound(),setTimeout(()=>{this.spawnEnemies()},300),this.waveIsScheduled=!0}});this.game=t}}const ti=(n,t,i)=>{switch(n){case P.ARCANE_ARCHER:return new L(y.generate(),t,i);case P.FIRE_MAGE:return new F(y.generate(),t,i);case P.Lightning_MAGE:return new O(y.generate(),t,i);default:throw new Error("Tower not found")}};class ii{constructor(){e(this,"towers",[]);e(this,"updateTowers",()=>{this.towers.forEach(t=>t.update())});e(this,"resetTowerTarget",t=>{this.towers.forEach(i=>{var s;((s=i.currentTarget)==null?void 0:s.id)===t&&i.removeTarget()})});e(this,"createTower",(t,i,s)=>{this.towers.push(ti(s.id,t,i))});e(this,"getTowerForTile",(t,i)=>this.towers.find(s=>s.x===t&&s.y===i));e(this,"hideTowerRange",()=>{this.towers.forEach(t=>t.setShowRange(!1))});e(this,"update",()=>{this.updateTowers()})}}const ni=n=>Math.floor(Math.random()*n);class z{constructor(t,i,s,a){e(this,"id");e(this,"x");e(this,"y");e(this,"image");e(this,"frameConfig");e(this,"sWidth");e(this,"sHeight");e(this,"imageTranslateX");e(this,"imageTranslateY");e(this,"dWidth");e(this,"dHeight");e(this,"health");e(this,"currentHealth");e(this,"speed");e(this,"maxSlowPercentage");e(this,"bountyGold");e(this,"state",Ce.MOVE);e(this,"animationDirection",u.RIGHT);e(this,"frameIteration",null);e(this,"frames",null);e(this,"flipOffsetFrames",null);e(this,"sX",null);e(this,"sY",null);e(this,"frameIterationThrottleTime",null);e(this,"lastFrameIteration",null);e(this,"nodeTarget");e(this,"pathNodes");e(this,"angle");e(this,"nodesIndex",0);e(this,"slows",[]);e(this,"getImgConfigForState",()=>{switch(this.state){case Ce.MOVE:return this.frameConfig.move;default:return this.frameConfig.move}});e(this,"setImageConfig",()=>{const{animationStartRight:t,animationStartLeft:i,frames:s,animationIterationCircleTime:a,flipOffsetFrames:r}=this.getImgConfigForState();this.sY=this.animationDirection===u.RIGHT?t.sy:i.sy,this.frames=s,this.flipOffsetFrames=r,this.frameIterationThrottleTime=a/this.frames,this.frameIteration=ni(this.frames)});e(this,"setFrameIteration",()=>{if(this.frames===null||this.frameIteration===null)throw new Error("frames or frameIteration is null");this.frameIteration<this.frames-1?this.frameIteration++:this.frameIteration=0});e(this,"setSxFrame",()=>{if(this.frames===null||this.flipOffsetFrames===null||this.frameIteration===null)throw new Error("frames or flipOffsetFrames or frameIteration is null");this.animationDirection===u.RIGHT?this.sX=this.frameIteration*this.sWidth:this.sX=(this.frames+this.flipOffsetFrames)*this.sWidth-(this.frameIteration+1)*this.sWidth});e(this,"draw",()=>{if(this.sX===null||this.sY===null)throw new Error("sX or sY is null");if(this.frameIteration===this.frames)throw new Error("frameIteration is equal to frames");h.ctxGame.drawImage(this.image,this.sX,this.sY,this.sWidth,this.sHeight,this.x-this.imageTranslateX,this.y-this.imageTranslateY,this.dWidth,this.dHeight);const t=.6,i=3,s=5,a=(this.dWidth-this.dWidth*t)/2;h.ctxGame.fillStyle="#7d0e0e",h.ctxGame.fillRect(this.x-this.imageTranslateX+a,this.y-this.imageTranslateY-s,this.dWidth*t,i),h.ctxGame.fillStyle="#0a5a0a",h.ctxGame.fillRect(this.x-this.imageTranslateX+a,this.y-this.imageTranslateY-s,this.dWidth*(this.currentHealth/this.health)*t,i)});e(this,"addSlow",t=>{this.slows.push(t)});e(this,"updateSlows",()=>{const t=performance.now();this.slows.forEach(i=>{t-i.slowStart>=i.slowDuration&&(this.slows=this.slows.filter(s=>s.id!==i.id))})});e(this,"getCurrentSpeed",()=>{if(this.slows.length===0)return this.speed;const t=this.slows.reduce((s,a)=>s+a.slowPercentage,0),i=t>this.maxSlowPercentage?this.maxSlowPercentage:t;return this.speed*((100-i)/100)});e(this,"move",()=>{const t=this.getCurrentSpeed(),i=Math.abs(this.nodeTarget.x-this.x);i-t<0?this.x+=i*Math.cos(this.angle*Math.PI/180):this.x+=t*Math.cos(this.angle*Math.PI/180);const s=Math.abs(this.nodeTarget.y-this.y);s-t<0?this.y+=s*Math.sin(this.angle*Math.PI/180):this.y+=t*Math.sin(this.angle*Math.PI/180),Je({x:this.x,y:this.y},{x:this.nodeTarget.x,y:this.nodeTarget.y})&&(this.updateNodeTarget(),this.updateAnimationDirection(),this.setImageConfig(),this.reduceBountyGold())});e(this,"updateNodeTarget",()=>{if(this.nodesIndex++,this.pathNodes.length===this.nodesIndex){m.playerHealth.reduceHealth(),m.enemies.remove(this.id);return}this.nodeTarget=this.pathNodes[this.nodesIndex],this.angle=K(this.x,this.y,this.nodeTarget.x,this.nodeTarget.y)});e(this,"updateAnimationDirection",()=>{this.x===this.nodeTarget.x&&(this.animationDirection=Math.random()<.5?u.RIGHT:u.LEFT),this.x<this.nodeTarget.x&&(this.animationDirection=u.RIGHT),this.x>this.nodeTarget.x&&(this.animationDirection=u.LEFT)});e(this,"updateFrames",()=>{if(this.lastFrameIteration===null)this.setSxFrame(),this.lastFrameIteration=performance.now();else{if(this.frameIterationThrottleTime===null)throw new Error("frameIterationThrottleTime is null");S(this.lastFrameIteration,this.frameIterationThrottleTime)&&(this.setFrameIteration(),this.setSxFrame(),this.lastFrameIteration=performance.now())}});e(this,"reduceBountyGold",()=>{this.bountyGold=Math.round(this.bountyGold*.9)});e(this,"reduceHealth",t=>{this.currentHealth-=t,this.currentHealth<=0&&(m.enemies.remove(this.id),m.gold.increaseGoldAfterKillEnemy(this.bountyGold),m.towers.resetTowerTarget(this.id))});e(this,"update",()=>{this.updateFrames(),this.updateSlows(),this.move(),this.draw()});this.id=t,this.x=i,this.y=s,this.image=Y.imageController.getImage(a.id),this.sWidth=a.sWidth,this.sHeight=a.sHeight,this.dWidth=a.imageScale*a.sWidth,this.dHeight=a.imageScale*a.sHeight,this.imageTranslateX=a.sWidth/2-a.imageTranslateCorrection.x,this.imageTranslateY=a.sHeight/2-a.imageTranslateCorrection.y,this.frameConfig=a.frameConfig,this.health=a.health,this.currentHealth=this.health,this.speed=a.speed,this.maxSlowPercentage=a.maxSlowPercentage,this.bountyGold=a.bountyGold,this.setImageConfig(),this.pathNodes=M.getPathNodes(),this.nodeTarget=this.pathNodes[this.nodesIndex],this.angle=K(this.x,this.y,this.nodeTarget.x,this.nodeTarget.y)}}const Se=class extends z{constructor(t,i,s){super(t,i,s,Se.config)}};let D=Se;e(D,"config",{id:"skeletonShield",name:"Shielded Skeleton",health:10,speed:2,maxSlowPercentage:50,sWidth:64,sHeight:64,imageScale:.8,imageTranslateCorrection:{x:5,y:-10},frameConfig:{move:{frames:4,animationIterationCircleTime:500,flipOffsetFrames:0,animationStartRight:{sx:0,sy:64},animationStartLeft:{sx:192,sy:384}}},bountyGold:5});const Ge=class extends z{constructor(t,i,s){super(t,i,s,Ge.config)}};let W=Ge;e(W,"config",{id:"mushroom",name:"Mad Mushroom",health:30,speed:2,maxSlowPercentage:80,sWidth:64,sHeight:64,imageScale:1,imageTranslateCorrection:{x:0,y:-20},frameConfig:{move:{frames:8,animationIterationCircleTime:500,flipOffsetFrames:0,animationStartRight:{sx:0,sy:64},animationStartLeft:{sx:192,sy:320}}},bountyGold:5});const Me=class extends z{constructor(t,i,s){super(t,i,s,Me.config)}};let X=Me;e(X,"config",{id:"goblin",name:"Greedy Goblin",health:40,speed:3,maxSlowPercentage:50,sWidth:64,sHeight:64,imageScale:1.1,imageTranslateCorrection:{x:-5,y:-25},frameConfig:{move:{frames:8,animationIterationCircleTime:500,flipOffsetFrames:0,animationStartRight:{sx:0,sy:64},animationStartLeft:{sx:192,sy:320}}},bountyGold:10});const He=class extends z{constructor(t,i,s){super(t,i,s,He.config)}};let j=He;e(j,"config",{id:"fireWorm",name:"Fire Worm",health:100,speed:2,maxSlowPercentage:20,sWidth:64,sHeight:64,imageScale:1,imageTranslateCorrection:{x:0,y:-10},frameConfig:{move:{frames:9,animationIterationCircleTime:500,flipOffsetFrames:0,animationStartRight:{sx:0,sy:0},animationStartLeft:{sx:512,sy:192}}},bountyGold:15});const be=class extends z{constructor(t,i,s){super(t,i,s,be.config)}};let N=be;e(N,"config",{id:"demon",name:"Demon",health:1e3,speed:1,maxSlowPercentage:0,special:{description:"Immune to slow effects"},sWidth:110,sHeight:110,imageScale:.8,imageTranslateCorrection:{x:15,y:-25},frameConfig:{move:{frames:12,animationIterationCircleTime:1e3,flipOffsetFrames:0,animationStartRight:{sx:0,sy:0},animationStartLeft:{sx:1210,sy:110}}},bountyGold:100});const R=class{constructor(){e(this,"waveIndex",0);e(this,"wasLastWave",!1);e(this,"createEnemyWave",()=>{if(this.waveIndex>=R.waves.length)throw new Error("No more waves available");const{className:t,unitCount:i,config:s}=R.waves[this.waveIndex],a=[],r=60;for(let o=0;o<i;o++){const{x:l,y:c}=R.startingPosition,d=l-o*r;a.push(new t(y.generate(),d,c))}return this.waveIndex++,this.waveIndex>=R.waves.length&&(this.wasLastWave=!0),{currentEnemies:a,config:s}})}};let k=R;e(k,"waves",[{id:D.config.id,className:D,config:D.config,unitCount:12},{id:W.config.id,className:W,config:W.config,unitCount:12},{id:X.config.id,className:X,config:X.config,unitCount:12},{id:j.config.id,className:j,config:j.config,unitCount:12},{id:N.config.id,className:N,config:N.config,unitCount:1}]),e(k,"startingPosition",{x:-30,y:160});k.waves.map(n=>n.config.name);class si{constructor(){e(this,"stop",!1);e(this,"lastAnimationTimestamp",null);e(this,"fps",60);e(this,"intervalInMiliseconds",1e3/this.fps);e(this,"menu");e(this,"towers");e(this,"enemies");e(this,"waves");e(this,"gold");e(this,"playerHealth");e(this,"round");e(this,"resetEventListeners",()=>{M.tileGras.forEach(t=>{t.setTowerBp(null),t.updateBG()}),this.towers.hideTowerRange(),this.menu.setSelectedTower(null),h.body.removeAllClassesFromBody()});e(this,"runGame",t=>{if(this.stop){console.log("end");return}t?S(this.lastAnimationTimestamp,this.intervalInMiliseconds)&&(this.lastAnimationTimestamp=t,this.update()):this.update(),requestAnimationFrame(this.runGame)});e(this,"stopGame",()=>{this.stop=!0});e(this,"update",()=>{if(this.playerHealth.getCurrentHealth()<=0){this.stopGame(),new Ue(oe.LOST);return}h.ctxGame.clearRect(0,0,h.canvasGame.width,h.canvasGame.height),this.enemies.update(),this.towers.update(),M.update(),this.round.update()});this.menu=new te,this.towers=new ii,this.enemies=new ht,this.waves=new k,this.gold=new ct,this.playerHealth=new Qt,this.round=new ei(this),M.createTileGrid(),M.buildTileImg(),this.runGame()}}const v=async n=>{const t=new Image(64,64);return t.src=n,await t.decode(),t},ai="/tower-defense/assets/arcaneArcher.93169575.png",ri="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAFCAYAAAA3zK6FAAAAAXNSR0IArs4c6QAAAFpJREFUKJFjYBjkgBFd4FnCr/8MDAwM4nosEAUG3xgYGBgYmJx4MNRSA/zt+/ef0eAbTvNxWgpzKAMDwrEYmqGOJwT+X+DCEHt56Q+cLa7HwoDLkYM+BAc9AADKMh8EGHHFLAAAAABJRU5ErkJggg==",oi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9bpVIqHdpBRCFDdbIIKuKoVShChVArtOpgcukXNGlIUlwcBdeCgx+LVQcXZ10dXAVB8APE1cVJ0UVK/F9SaBHjwXE/3t173L0D/M0qU82eWUDVLCOTSgq5/KoQfEUIUUQwjHGJmfqcKKbhOb7u4ePrXYJneZ/7c/QrBZMBPoF4lumGRbxBPL1p6Zz3iWOsLCnE58RjBl2Q+JHrsstvnEsO+3lmzMhm5oljxEKpi+UuZmVDJZ4ijiuqRvn+nMsK5y3OarXO2vfkLwwXtJVlrtMcQgqLWIIIATLqqKAKCwlaNVJMZGg/6eEfdPwiuWRyVcDIsYAaVEiOH/wPfndrFicn3KRwEuh9se2PESC4C7Qatv19bNutEyDwDFxpHX+tCcx8kt7oaPEjILINXFx3NHkPuNwBBp50yZAcKUDTXywC72f0TXkgeguE1tze2vs4fQCy1FX6Bjg4BEZLlL3u8e6+7t7+PdPu7wfG9HLIP4lGJwAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+cKEw8hF8uZtlMAAASPSURBVHja7VlfSBt3HP/cmaVpJjotMzmn0qUPUYuZTxbj5rooHdvDWCpbOxHxIQz6MFiDo6t2G/vzKDK2gRuETooPZcUGZB0MNIg0Kd3D0BZi7sUOF0x1K2oRp6HJbw/ud7tLY5MzuTRHfp+XwO9+ubvP5/f9fwADAwMDAwNDvpEMbBE9vCdf6gfFa3X6ZN5cugLohbwmAlDfX73zqPQEoKavF/J5FUBOvnbcyJVcykuMJsnKQJyg1KB38oan7fNDbcOk0VSlWOufG+R0FwMO4vfpyAPAlc4RojsBDkI+tBnG5dUgPt24BgCI7KzvKwJ1taIVQE0MoOSXtu9j9xiBUCcoRJALoXV6zSkG8K5yLhnYIhaYJRHUukJwcAKUnPP3V9Br6gYAjJXfVFSWWqXXnC2Ad5VzXOt2Vnuv3piSrGRp+z4AoGOkDy9Pn0bP2ruKvbFoDEcdJ8jKQJyUeXnO4jBo4gY5CZAMbJHUxudJruCfCaL9zbcV1292X8dkzU8AAKFOAADQwPjFc+/gu/DnSIwmSZmX57RwA4NawryrnKOnQOZpzf8oYza4emOK+GeCiEVjgOk4vnqxB5fuTaI3ehGoBhqq7ViOiBL55DqPiGkdoc0wun7owVDbMCnz8nl3AU4tefqbLgCmI0/N3j8TxHJERCwag1An4LW/j6PRVIXLq0HFfmdlMyZiAfQJLoQ2wwjXJxTX16anuKITgFpEb/QiliMi/jn9OgBgd0HEg8UlAMAxIy+Rb2i049a1OfQJLgAAzQh9ggsTsQAAwGa2IlyfQO3ZNxTvsbsgYvHbrzlNBSiWcdZ7P3+J29OzOPxqu7RGBc2XJeTVArLx0ZN2t0Jcmg2qP+uXLOab8x7JZWhG2K6xaOIGhnzcRE1knhX93Em7mzgrm6W1jY9OSeRN4l/43vsjZkU/d9RxggDAH3dua9YbqLpxahaQbiKrA1KtI1MPMNr/rIK8zWzFrOgvWDOU04P2y/mZKjZa5z9t8jkXQrXjRq523MhZ++OwOAxZkR9qG96XvNwtdDEPOEij8sv7dfAviMDC/xF9x/48Ns6e2lv/rbACcPkkn+n0a7rfesxljjTZNElvBc0C2Q5ERuKduHRvUrHmftiC0GYYFpRJKVGXAmTClc4REtlZh81sVZS9jaYq+CoS8Dxs2VusbyfLf97S30gs00AksrPX2FDilPygcQ4A4Ku4C2dlM2xmKxrq24kuLEA+EMkmCNIoLycujwG+irvwoAXOymaEzFZSiJSYlwdk81Gk6YMPCQ10qSVtq2+MyBunQgbDvLgAnQpZHAbJFeQNVatvjBx6yY4jTTbpxOUE5z3nOHq90MhbDEgVYb8vxA8Wl9KebqoI6VJmUQuQOh+kMaHVN0bks4Enmfa85xynWwuQi0DLYgD4WHgBh6//mpE8heOZQzCvreorBjwWWf+zAjoHVBPU6AxA91gZiJMz3guE9vTZQO3+orUA+WlqOcwoWgHOeC+Q89Wf7I3AVQoGAIW0Ak0EcHd1wN3Vofp/csEK7QoMDAwMDAwMDAwMDAwMDAylg38BwpOl42pBq6AAAAAASUVORK5CYII=",hi="/tower-defense/assets/textures.3afee45f.png",li="/tower-defense/assets/skeletonShield.d1002680.png",ci="/tower-defense/assets/mushroom.14731a48.png",di="/tower-defense/assets/goblin.5ef62492.png",mi="/tower-defense/assets/fireMage.0977364e.png",ui="/tower-defense/assets/fireMageProjectile.1200d795.png",gi="/tower-defense/assets/fireMageBp.4c064c7f.png",fi="/tower-defense/assets/fireWorm.a9e32668.png",wi="/tower-defense/assets/demon.e8dd8c44.png",pi="/tower-defense/assets/lightningMage.e144c4dc.png",Ti="/tower-defense/assets/lightningMageProjectile.8810b3c2.png",Ii="/tower-defense/assets/lightningMageBp.138d9d4b.png";class vi{constructor(){e(this,"textures",null);e(this,"arcaneArcher",null);e(this,"arcaneArcherProjectile",null);e(this,"arcaneArcherBp",null);e(this,"fireMage",null);e(this,"fireMageProjectile",null);e(this,"fireMageBp",null);e(this,"lightningMage",null);e(this,"lightningMageProjectile",null);e(this,"lightningMageBp",null);e(this,"skeletonShield",null);e(this,"mushroom",null);e(this,"goblin",null);e(this,"fireWorm",null);e(this,"demon",null);e(this,"loadImages",async()=>{this.textures=await v(hi),this.arcaneArcher=await v(ai),this.arcaneArcherProjectile=await v(ri),this.arcaneArcherBp=await v(oi),this.fireMage=await v(mi),this.fireMageProjectile=await v(ui),this.fireMageBp=await v(gi),this.lightningMage=await v(pi),this.lightningMageProjectile=await v(Ti),this.lightningMageBp=await v(Ii),this.skeletonShield=await v(li),this.mushroom=await v(ci),this.goblin=await v(di),this.fireWorm=await v(fi),this.demon=await v(wi)});e(this,"getImage",t=>{const i=this[t];if(i===null)throw new Error("Images not loaded yet");return i})}}class Ci{constructor(){e(this,"columLength",8);e(this,"rowLength",16);e(this,"tileWdith",64);e(this,"tileHeight",this.tileWdith);e(this,"tilesTotal",this.columLength*this.rowLength);e(this,"pathConfiguration",[{id:32,direction:"horizontal"},{id:33,direction:"horizontal"},{id:34,direction:"corner"},{id:50,direction:"vertical"},{id:66,direction:"vertical"},{id:82,direction:"vertical"},{id:98,direction:"corner"},{id:99,direction:"horizontal"},{id:100,direction:"horizontal"},{id:101,direction:"corner"},{id:85,direction:"vertical"},{id:69,direction:"vertical"},{id:53,direction:"vertical"},{id:37,direction:"vertical"},{id:21,direction:"corner"},{id:22,direction:"horizontal"},{id:23,direction:"horizontal"},{id:24,direction:"horizontal"},{id:25,direction:"horizontal"},{id:26,direction:"corner"},{id:42,direction:"vertical"},{id:58,direction:"vertical"},{id:74,direction:"corner"},{id:73,direction:"horizontal"},{id:72,direction:"corner"},{id:88,direction:"vertical"},{id:104,direction:"corner"},{id:105,direction:"horizontal"},{id:106,direction:"horizontal"},{id:107,direction:"horizontal"},{id:108,direction:"horizontal"},{id:109,direction:"corner"},{id:93,direction:"vertical"},{id:77,direction:"vertical"},{id:61,direction:"vertical"},{id:45,direction:"vertical"},{id:29,direction:"vertical"},{id:13,direction:"vertical"}]);e(this,"pathEndPoint",{x:864,y:-32});e(this,"tileRows",[]);e(this,"tilePaths",[]);e(this,"tileGras",[]);e(this,"debug",!1);e(this,"getTileX",t=>t%this.rowLength*this.tileWdith);e(this,"getTileY",()=>this.tileRows.length*this.tileWdith);e(this,"createTileGrid",()=>{for(let t=0,i=[];t<this.tilesTotal;t++){const s=this.pathConfiguration.find(a=>a.id===t);if(s!==void 0){const a=new je(t,this.getTileX(t),this.getTileY(),s.direction);i.push(a),this.tilePaths.push(a)}else{const a=new H(t,this.getTileX(t),this.getTileY());i.push(a),this.tileGras.push(a)}i.length===this.rowLength&&(this.tileRows.push(i),i=[])}});e(this,"buildTileImg",()=>{this.tileRows.forEach(t=>{t.forEach(i=>{i.updateBG()})})});e(this,"getTileRows",()=>this.tileRows);e(this,"getTilePaths",()=>this.tilePaths);e(this,"getPathConfiguration",()=>this.pathConfiguration);e(this,"getPathConfigurationCorners",()=>this.getPathConfiguration().filter(t=>t.direction==="corner").map(t=>t.id));e(this,"getPathEndPoint",()=>this.pathEndPoint);e(this,"getPathNodes",()=>[...this.getTilePaths().filter(t=>t.direction==="corner").sort((t,i)=>this.getPathConfigurationCorners().indexOf(t.id)-this.getPathConfigurationCorners().indexOf(i.id)).map(t=>({x:t.x+32,y:t.y+32})),this.getPathEndPoint()]);e(this,"updateTilesGras",()=>{this.tileGras.forEach(t=>t.update())});e(this,"update",()=>{this.updateTilesGras()});e(this,"drawGrid",()=>{this.debug?this.tileRows.forEach(t=>{t.forEach(i=>{i.updateBG()})}):this.tileRows.forEach(t=>{t.forEach(i=>{i.drawGrid()})}),this.debug=!this.debug})}}class xi{constructor(){e(this,"loadingScreen");e(this,"removeLoadingScreen",()=>{this.loadingScreen.remove()});this.loadingScreen=document.createElement("div"),this.loadingScreen.id="loading-screen",this.loadingScreen.classList.add("box-shadow"),this.loadingScreen.innerHTML="Loading...",document.body.appendChild(this.loadingScreen)}}class Ai{constructor(t){e(this,"startScreen");e(this,"startButton");e(this,"buttonCallback");e(this,"scaleInTransform",[{transform:"translate(-50%, -50%) scale(1)"},{transform:"translate(-50%, -50%) scale(0.9)"}]);e(this,"scaleInTiming",100);this.buttonCallback=t,this.startScreen=document.createElement("div"),this.startScreen.id="start-screen",this.startScreen.classList.add("box-shadow"),this.startButton=document.createElement("button"),this.startButton.id="start-button",this.startButton.classList.add("box-shadow","play-button"),this.startButton.innerHTML="START",this.startButton.addEventListener("click",()=>{this.removeStartScreen()}),this.startScreen.appendChild(this.startButton),document.body.appendChild(this.startScreen)}removeStartScreen(){this.startScreen.animate(this.scaleInTransform,this.scaleInTiming),setTimeout(()=>{this.startScreen.remove(),this.buttonCallback()},this.scaleInTiming)}}let h,M,m;class Ei{constructor(){e(this,"loadingScreen");e(this,"imageController");e(this,"initiateGame",()=>{h=new ot,M=new Ci,m=new si});this.loadingScreen=new xi,this.imageController=new vi,this.imageController.loadImages().then(()=>{this.loadingScreen.removeLoadingScreen(),new Ai(this.initiateGame)})}}const Y=new Ei;

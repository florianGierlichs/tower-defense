var Ke=Object.defineProperty;var $e=(s,t,i)=>t in s?Ke(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var e=(s,t,i)=>($e(s,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=i(a);fetch(a.href,r)}})();class qe{constructor(t){e(this,"width",1024);e(this,"height",512);e(this,"canvas");e(this,"ctx");e(this,"getCanvas",()=>this.canvas);e(this,"getCtx",()=>this.ctx);this.canvas=document.createElement("canvas"),this.canvas.id="canvas-background";const i=this.canvas.getContext("2d");if(i===null)throw new Error("Context not found");this.ctx=i,this.canvas.width=this.width,this.canvas.height=this.height,t.appendChild(this.canvas)}}class Ve{constructor(t){e(this,"canvasBorder");e(this,"canvasContainer");e(this,"getCanvasContainer",()=>this.canvasContainer);this.canvasBorder=document.createElement("div"),this.canvasBorder.id="canvas-border",this.canvasBorder.classList.add("box-shadow"),this.canvasContainer=document.createElement("div"),this.canvasContainer.id="canvas-container",this.canvasBorder.appendChild(this.canvasContainer),t.appendChild(this.canvasBorder)}}const Fe=s=>({x:s.offsetX,y:s.offsetY}),He=s=>{const t=H.getTileRows(),{x:i,y:n}=Fe(s);let a=null;return t.forEach(r=>{r.forEach(o=>{i>=o.x&&i<=o.x+o.width&&n>=o.y&&n<=o.y+o.height&&(a=o)})}),a},Le=s=>{const t=H.getTileRows(),{x:i,y:n}=Fe(s);let a=null;return t.forEach(r=>{r.forEach(o=>{i>=o.x&&i<=o.x+o.width&&n>=o.y&&n<=o.y+o.height&&(a=o)})}),a};class Be{constructor(t,i,n){e(this,"id");e(this,"x");e(this,"y");e(this,"width",64);e(this,"height",64);e(this,"sWidth",64);e(this,"sHeight",this.sWidth);e(this,"dWidth",64);e(this,"dHeight",this.dWidth);e(this,"dX");e(this,"dY");e(this,"drawGrid",()=>{h.ctxBackground.lineWidth=.1,h.ctxBackground.strokeStyle="black",h.ctxBackground.font=" 10px sans-serif",h.ctxBackground.fillStyle="white",h.ctxBackground.beginPath(),h.ctxBackground.strokeRect(this.x,this.y,this.width,this.height),h.ctxBackground.fillText(`${this.id}`,this.x+5,this.y+10),h.ctxBackground.fillText(`X:${this.x}-${this.x+64}`,this.x+5,this.y+30),h.ctxBackground.fillText(`Y:${this.y} ${this.y+64}`,this.x+5,this.y+50)});this.id=t,this.x=i,this.y=n,this.dX=i,this.dY=n}}const Te=s=>s[Math.floor(Math.random()*s.length)],We=({x:s,y:t})=>{const i=s+32,n=t+64/2;return{x:i,y:n}};class R extends Be{constructor(i,n,a){super(i,n,a);e(this,"hasTower",!1);e(this,"showTowerBP",null);e(this,"image");e(this,"sX");e(this,"sY");e(this,"towerBpImage",null);e(this,"tileGrasCoords",[{sx:0*this.sWidth,sy:0*this.sHeight},{sx:0*this.sWidth,sy:1*this.sHeight},{sx:1*this.sWidth,sy:0*this.sHeight},{sx:1*this.sWidth,sy:1*this.sHeight},{sx:2*this.sWidth,sy:0*this.sHeight},{sx:2*this.sWidth,sy:1*this.sHeight},{sx:3*this.sWidth,sy:0*this.sHeight},{sx:3*this.sWidth,sy:1*this.sHeight}]);e(this,"getImgConfig",()=>Te(this.tileGrasCoords));e(this,"drawImg",()=>{this.image!==null&&h.ctxBackground.drawImage(this.image,this.sX,this.sY,this.sWidth,this.sHeight,this.dX,this.dY,this.dWidth,this.dHeight)});e(this,"setHasTower",()=>this.hasTower=!0);e(this,"setShowTowerBp",i=>{this.showTowerBP=i});e(this,"drawTowerBp",()=>{if(this.showTowerBP!==null){const i=N.imageController.getImage(this.showTowerBP.blueprintId);h.ctxGame.drawImage(i,this.dX,this.dY);const n=We({x:this.x,y:this.y});h.ctxGame.beginPath(),h.ctxGame.arc(n.x,n.y,this.showTowerBP.range,0,Math.PI*2),h.ctxGame.fillStyle="rgba(225,225,225,0.1)",h.ctxGame.fill()}});e(this,"updateBG",()=>{this.drawImg()});e(this,"update",()=>{this.showTowerBP!==null&&this.drawTowerBp()});this.image=N.imageController.getImage("textures"),this.sX=this.getImgConfig().sx,this.sY=this.getImgConfig().sy}}class Oe extends Be{constructor(i,n,a,r){super(i,n,a);e(this,"sX");e(this,"sY");e(this,"horizontalTilePathsCoords",[{sx:2*this.sWidth,sy:2*this.sHeight},{sx:3*this.sWidth,sy:2*this.sHeight}]);e(this,"verticalTilePathsCoords",[{sx:1*this.sWidth,sy:2*this.sHeight},{sx:1*this.sWidth,sy:3*this.sHeight}]);e(this,"cornerTilePathCoords",{sx:0*this.sWidth,sy:2*this.sHeight});e(this,"direction");e(this,"getImgConfig",()=>{let i;switch(this.direction){case"horizontal":i=Te(this.horizontalTilePathsCoords);break;case"vertical":i=Te(this.verticalTilePathsCoords);break;default:i=this.cornerTilePathCoords}return i});e(this,"drawImg",()=>{const i=N.imageController.getImage("textures");h.ctxBackground.drawImage(i,this.sX,this.sY,this.sWidth,this.sHeight,this.dX,this.dY,this.dWidth,this.dHeight)});e(this,"updateBG",()=>{this.drawImg()});this.direction=r,this.sX=this.getImgConfig().sx,this.sY=this.getImgConfig().sy}}class Je{constructor(t){e(this,"element");e(this,"scaleInTransformIn",[{transform:"translate(-50%, -50%) scale(0.5)"},{transform:"translate(-50%, -50%) scale(1)"}]);e(this,"scaleInTransformOut",[{transform:"translate(-50%, -50%) scale(1)"},{transform:"translate(-50%, -50%) scale(0.5)"}]);e(this,"scaleInTiming",100);e(this,"remove",()=>{this.element.animate(this.scaleInTransformOut,this.scaleInTiming),setTimeout(()=>{this.element.remove()},this.scaleInTiming)});this.element=document.createElement("h2"),this.element.id="info-message",this.element.innerHTML=t,document.body.appendChild(this.element),this.element.animate(this.scaleInTransformIn,this.scaleInTiming),setTimeout(()=>{this.remove()},1e3)}}class Qe{constructor(t){e(this,"width",1024);e(this,"height",512);e(this,"canvas");e(this,"ctx");e(this,"previousTileForHover",null);e(this,"getCanvas",()=>this.canvas);e(this,"getCtx",()=>this.ctx);e(this,"mouseMoveCallback",t=>{this.showTowerBpOnTile(t)});e(this,"mouseLeaveCallback",t=>{this.resetPreviousTileForHover()});e(this,"clickCallback",t=>{this.showTowerRange(t),this.placeTowerOnTile(t)});e(this,"showTowerBpOnTile",t=>{const i=d.menu.getSelectedTower();if(i===null)return;const n=Le(t);this.previousTileForHover!==n&&(this.previousTileForHover instanceof R&&this.previousTileForHover.setShowTowerBp(null),n instanceof R&&!n.hasTower&&(n.setShowTowerBp(i),h.body.removeAllClassesFromBody(),n.update()),(n instanceof R&&!n.showTowerBP||n instanceof Oe)&&h.body.addTowerMouseCursor(i),this.previousTileForHover=n)});e(this,"resetPreviousTileForHover",()=>{this.previousTileForHover instanceof R&&(this.previousTileForHover.setShowTowerBp(null),this.previousTileForHover.updateBG()),this.previousTileForHover=null});e(this,"placeTowerOnTile",t=>{const i=d.menu.getSelectedTower();if(i===null)return;if(d.gold.getCurrentGold()<i.price){new Je("Not enough Gold!");return}const a=He(t);a instanceof R&&!a.hasTower&&(d.towers.createTower(a.x,a.y,i),d.gold.reduceGold(i.price),a.setHasTower(),a.setShowTowerBp(null),a.updateBG(),d.menu.setSelectedTower(null),h.body.removeAllClassesFromBody())});e(this,"showTowerRange",t=>{const i=He(t);if(i instanceof R&&i.hasTower&&d.menu.getSelectedTower()===null){const n=d.towers.getTowerForTile(i.x,i.y);n==null||n.setShowRange(!0)}});this.canvas=document.createElement("canvas"),this.canvas.id="canvas-game";const i=this.canvas.getContext("2d");if(i===null)throw new Error("Context not found");this.ctx=i,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.addEventListener("mousemove",this.mouseMoveCallback),this.canvas.addEventListener("mouseleave",this.mouseLeaveCallback),this.canvas.addEventListener("click",this.clickCallback),t.appendChild(this.canvas)}}class Ze{constructor(){e(this,"body");e(this,"contextmenuCallback",t=>{t.preventDefault(),d.resetEventListeners()});e(this,"clickCallback",t=>{d.towers.hideTowerRange()});e(this,"mouseMoveCallback",t=>{this.showTowerMouseCursor(t)});e(this,"showTowerMouseCursor",t=>{const i=d.menu.getSelectedTower(),n=Le(t);i!==null&&(n instanceof R&&n.showTowerBP===null||n===null)&&this.addTowerMouseCursor(i)});e(this,"addTowerMouseCursor",t=>{this.body.classList.add(t.id)});e(this,"removeAllClassesFromBody",()=>{this.body.className=""});const t=document.querySelector("body");if(t===null)throw new Error("Body not found");this.body=t,this.body.addEventListener("contextmenu",this.contextmenuCallback),this.body.addEventListener("click",this.clickCallback,!0),this.body.addEventListener("mousemove",this.mouseMoveCallback)}}class _e{constructor(){e(this,"gameContainer");e(this,"guiContainer");e(this,"scaleInTransform",[{transform:"scale(0.9)"},{transform:"scale(1)"}]);e(this,"scaleInTiming",150);e(this,"getGuiContainer",()=>this.guiContainer);const t=document.getElementById("game-container");if(t===null)throw new Error("game-container not found");this.gameContainer=t,this.guiContainer=document.createElement("div"),this.guiContainer.id="gui-container",this.gameContainer.appendChild(this.guiContainer),this.guiContainer.animate(this.scaleInTransform,this.scaleInTiming)}}class et{constructor(t){e(this,"menuBorder");e(this,"menuContainer");e(this,"menuTowersContainer");e(this,"menuGameStatsContainer");e(this,"getMenuContainer",()=>this.menuContainer);e(this,"getMenuTowersContainer",()=>this.menuTowersContainer);e(this,"addChildToMenuTowersContainer",t=>{this.menuTowersContainer.appendChild(t)});e(this,"addMenuItemGold",t=>{this.menuGameStatsContainer.appendChild(t)});e(this,"addMenuItemPlayerHealth",t=>{this.menuGameStatsContainer.appendChild(t)});this.menuBorder=document.createElement("div"),this.menuBorder.id="menu-border",this.menuBorder.classList.add("box-shadow"),this.menuContainer=document.createElement("div"),this.menuContainer.id="menu-container",this.menuTowersContainer=document.createElement("div"),this.menuTowersContainer.id="menu-towers-container",this.menuGameStatsContainer=document.createElement("div"),this.menuGameStatsContainer.id="menu-game-stats-container",this.menuBorder.appendChild(this.menuContainer),this.menuContainer.appendChild(this.menuGameStatsContainer),this.menuContainer.appendChild(this.menuTowersContainer),t.appendChild(this.menuBorder)}}class tt{constructor(){e(this,"toggleTilesInfoButton");e(this,"toggleGrid",()=>{H.drawGrid()});const t=document.querySelector("#toggle-tiles-info");if(t===null)throw new Error("toggleTilesInfoButton not found");this.toggleTilesInfoButton=t,this.toggleTilesInfoButton.addEventListener("click",this.toggleGrid)}}class it{constructor(){e(this,"guiContainer");e(this,"canvasContainer");e(this,"canvasBackground");e(this,"canvasGame");e(this,"ctxBackground");e(this,"ctxGame");e(this,"menuContainer");e(this,"body");this.guiContainer=new _e,this.canvasContainer=new Ve(this.guiContainer.getGuiContainer());const t=new qe(this.canvasContainer.getCanvasContainer());this.canvasBackground=t.getCanvas(),this.ctxBackground=t.getCtx();const i=new Qe(this.canvasContainer.getCanvasContainer());this.canvasGame=i.getCanvas(),this.ctxGame=i.getCtx(),this.menuContainer=new et(this.guiContainer.getGuiContainer()),new tt,this.body=new Ze}}const A=(s,t)=>{const i=performance.now();return!s||i-s>=t};var ve=(s=>(s.IDLE="idle",s.MOVE="move",s))(ve||{}),C=(s=>(s.IDLE="idle",s.ATTACK="attack",s))(C||{}),u=(s=>(s.LEFT="left",s.RIGHT="right",s))(u||{}),F=(s=>(s.ARCANE_ARCHER="arcaneArcher",s.FIRE_MAGE="fireMage",s.Lightning_MAGE="lightningMage",s))(F||{}),se=(s=>(s.ARCANE_ARCHER="arcaneArcherProjectile",s.FIRE_MAGE="fireMageProjectile",s.LIGHTNING_MAGE="lightningMageProjectile",s))(se||{}),ne=(s=>(s.ARCANE_ARCHER="arcaneArcherBp",s.FIRE_MAGE="fireMageBp",s.LIGHTNING_MAGE="lightningMageBp",s))(ne||{}),ae=(s=>(s[s.WON=0]="WON",s[s.LOST=1]="LOST",s))(ae||{});class st{constructor(){e(this,"currentEnemies",[]);e(this,"allEnemiesRemoved",!0);e(this,"updateEnemies",()=>{this.currentEnemies.forEach(t=>t.update())});e(this,"remove",t=>{this.currentEnemies=this.currentEnemies.filter(i=>i.id!==t)});e(this,"getCurrentEnemies",()=>this.currentEnemies);e(this,"setCurrentEnemies",t=>{this.currentEnemies=t,this.allEnemiesRemoved=!1});e(this,"update",()=>{this.updateEnemies(),this.currentEnemies.length===0&&(this.allEnemiesRemoved=!0)})}}class nt{constructor(){e(this,"menuItem");e(this,"startGold",100);e(this,"currentGold",this.startGold);e(this,"collectedBountyGoldPerRound",0);e(this,"percentageGoldIncreasePerRound",0);e(this,"staticGoldIncrease",50);e(this,"percentageGoldIncrease",10);e(this,"reduceGold",t=>{this.currentGold-=t,this.update()});e(this,"increaseGoldAfterRound",()=>{this.percentageGoldIncreasePerRound=Math.round(this.percentageGoldIncrease/100*this.currentGold),this.currentGold=Math.round(this.currentGold+this.staticGoldIncrease+this.percentageGoldIncreasePerRound),this.update()});e(this,"increaseGoldAfterKillEnemy",t=>{this.collectedBountyGoldPerRound+=t,this.currentGold+=t,this.update()});e(this,"resetDynamicGoldIncreasePerRound",()=>{this.collectedBountyGoldPerRound=0,this.percentageGoldIncreasePerRound=0});this.menuItem=document.createElement("div"),this.menuItem.classList.add("menu-item","menu-item-stats"),this.menuItem.id="menu-item-gold",this.menuItem.innerHTML=`Gold: <br>${this.currentGold}`,h.menuContainer.addMenuItemGold(this.menuItem)}getCurrentGold(){return this.currentGold}getCollectedBountyGoldPerRound(){return this.collectedBountyGoldPerRound}getPercentageGoldIncreasePerRound(){return this.percentageGoldIncreasePerRound}update(){this.menuItem.innerHTML=`Gold: <br>${this.currentGold}`}}class De{constructor(t){e(this,"endScreen");e(this,"headline");e(this,"resultElement");e(this,"result");e(this,"wonText","You won!");e(this,"lostText","You lost all your lives!");e(this,"scaleInTransform",[{transform:"translate(-50%, -50%) scale(0.5)"},{transform:"translate(-50%, -50%) scale(1)"}]);e(this,"scaleInTiming",100);this.result=t,this.endScreen=document.createElement("div"),this.endScreen.id="end-screen",this.endScreen.classList.add("box-shadow"),this.headline=document.createElement("h2"),this.headline.id="end-screen-headline",this.headline.innerHTML="GAME OVER",this.resultElement=document.createElement("h2"),this.resultElement.id="end-screen-result",this.resultElement.innerHTML=this.result===ae.WON?this.wonText:this.lostText,this.endScreen.appendChild(this.headline),this.endScreen.appendChild(this.resultElement),document.body.appendChild(this.endScreen),this.endScreen.animate(this.scaleInTransform,this.scaleInTiming)}}class at{constructor(t){e(this,"tower");e(this,"container");e(this,"createStatsText",(t,i)=>{const n=document.createElement("p");n.classList.add("tower-stats-text");const a=document.createElement("span");if(a.classList.add("tower-stats-text-key"),a.innerHTML=t,n.appendChild(a),i!==void 0){const r=document.createElement("span");r.classList.add("tower-stats-text-value"),r.innerHTML=i,n.appendChild(r)}this.container.appendChild(n)});e(this,"getContainer",()=>this.container);this.tower=t,this.container=document.createElement("div"),this.container.classList.add("tower-stats-container","box-shadow"),this.createStatsText(t.name),this.createStatsText("Damage:",t.damage.toString()),this.createStatsText("Range:",t.range.toString()),this.createStatsText("Attack speed:",t.attackSpeed.toString()),this.createStatsText("Price:",t.price.toString())}}class rt{constructor(t,i){e(this,"tower");e(this,"container");e(this,"element");e(this,"selectTowerCallback");e(this,"showTowerStats",!1);e(this,"stats");e(this,"clickHandler",()=>{this.selectTowerCallback(this.tower)});e(this,"showStats",()=>{this.showTowerStats||(this.container.appendChild(this.stats.getContainer()),this.showTowerStats=!0)});e(this,"removeStats",()=>{this.container.removeChild(this.stats.getContainer()),this.showTowerStats=!1});this.tower=t,this.selectTowerCallback=i,this.container=document.createElement("div"),this.container.classList.add("menu-item-container"),this.element=document.createElement("div"),this.element.id=t.id,this.element.classList.add("menu-item-tower"),this.element.addEventListener("click",this.clickHandler),this.container.addEventListener("mouseover",this.showStats),this.container.addEventListener("mouseleave",this.removeStats),this.container.appendChild(this.element),h.menuContainer.addChildToMenuTowersContainer(this.container),this.stats=new at(this.tower)}}function ot(s){var t=s.default;if(typeof t=="function"){var i=function(){return t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var a=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(i,n,a.get?a:{enumerable:!0,get:function(){return s[n]}})}),i}var Q,ht=new Uint8Array(16);function je(){if(!Q&&(Q=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Q))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Q(ht)}const lt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function re(s){return typeof s=="string"&&lt.test(s)}var g=[];for(var ce=0;ce<256;++ce)g.push((ce+256).toString(16).substr(1));function oe(s){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=(g[s[t+0]]+g[s[t+1]]+g[s[t+2]]+g[s[t+3]]+"-"+g[s[t+4]]+g[s[t+5]]+"-"+g[s[t+6]]+g[s[t+7]]+"-"+g[s[t+8]]+g[s[t+9]]+"-"+g[s[t+10]]+g[s[t+11]]+g[s[t+12]]+g[s[t+13]]+g[s[t+14]]+g[s[t+15]]).toLowerCase();if(!re(i))throw TypeError("Stringified UUID is invalid");return i}var Re,de,me=0,ue=0;function ct(s,t,i){var n=t&&i||0,a=t||new Array(16);s=s||{};var r=s.node||Re,o=s.clockseq!==void 0?s.clockseq:de;if(r==null||o==null){var c=s.random||(s.rng||je)();r==null&&(r=Re=[c[0]|1,c[1],c[2],c[3],c[4],c[5]]),o==null&&(o=de=(c[6]<<8|c[7])&16383)}var l=s.msecs!==void 0?s.msecs:Date.now(),m=s.nsecs!==void 0?s.nsecs:ue+1,v=l-me+(m-ue)/1e4;if(v<0&&s.clockseq===void 0&&(o=o+1&16383),(v<0||l>me)&&s.nsecs===void 0&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");me=l,ue=m,de=o,l+=122192928e5;var x=((l&268435455)*1e4+m)%4294967296;a[n++]=x>>>24&255,a[n++]=x>>>16&255,a[n++]=x>>>8&255,a[n++]=x&255;var y=l/4294967296*1e4&268435455;a[n++]=y>>>8&255,a[n++]=y&255,a[n++]=y>>>24&15|16,a[n++]=y>>>16&255,a[n++]=o>>>8|128,a[n++]=o&255;for(var S=0;S<6;++S)a[n+S]=r[S];return t||oe(a)}function Xe(s){if(!re(s))throw TypeError("Invalid UUID");var t,i=new Uint8Array(16);return i[0]=(t=parseInt(s.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=t&255,i[4]=(t=parseInt(s.slice(9,13),16))>>>8,i[5]=t&255,i[6]=(t=parseInt(s.slice(14,18),16))>>>8,i[7]=t&255,i[8]=(t=parseInt(s.slice(19,23),16))>>>8,i[9]=t&255,i[10]=(t=parseInt(s.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=t&255,i}function dt(s){s=unescape(encodeURIComponent(s));for(var t=[],i=0;i<s.length;++i)t.push(s.charCodeAt(i));return t}var mt="6ba7b810-9dad-11d1-80b4-00c04fd430c8",ut="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Ne(s,t,i){function n(a,r,o,c){if(typeof a=="string"&&(a=dt(a)),typeof r=="string"&&(r=Xe(r)),r.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var l=new Uint8Array(16+a.length);if(l.set(r),l.set(a,r.length),l=i(l),l[6]=l[6]&15|t,l[8]=l[8]&63|128,o){c=c||0;for(var m=0;m<16;++m)o[c+m]=l[m];return o}return oe(l)}try{n.name=s}catch{}return n.DNS=mt,n.URL=ut,n}function gt(s){if(typeof s=="string"){var t=unescape(encodeURIComponent(s));s=new Uint8Array(t.length);for(var i=0;i<t.length;++i)s[i]=t.charCodeAt(i)}return ft(wt(pt(s),s.length*8))}function ft(s){for(var t=[],i=s.length*32,n="0123456789abcdef",a=0;a<i;a+=8){var r=s[a>>5]>>>a%32&255,o=parseInt(n.charAt(r>>>4&15)+n.charAt(r&15),16);t.push(o)}return t}function Ye(s){return(s+64>>>9<<4)+14+1}function wt(s,t){s[t>>5]|=128<<t%32,s[Ye(t)-1]=t;for(var i=1732584193,n=-271733879,a=-1732584194,r=271733878,o=0;o<s.length;o+=16){var c=i,l=n,m=a,v=r;i=f(i,n,a,r,s[o],7,-680876936),r=f(r,i,n,a,s[o+1],12,-389564586),a=f(a,r,i,n,s[o+2],17,606105819),n=f(n,a,r,i,s[o+3],22,-1044525330),i=f(i,n,a,r,s[o+4],7,-176418897),r=f(r,i,n,a,s[o+5],12,1200080426),a=f(a,r,i,n,s[o+6],17,-1473231341),n=f(n,a,r,i,s[o+7],22,-45705983),i=f(i,n,a,r,s[o+8],7,1770035416),r=f(r,i,n,a,s[o+9],12,-1958414417),a=f(a,r,i,n,s[o+10],17,-42063),n=f(n,a,r,i,s[o+11],22,-1990404162),i=f(i,n,a,r,s[o+12],7,1804603682),r=f(r,i,n,a,s[o+13],12,-40341101),a=f(a,r,i,n,s[o+14],17,-1502002290),n=f(n,a,r,i,s[o+15],22,1236535329),i=w(i,n,a,r,s[o+1],5,-165796510),r=w(r,i,n,a,s[o+6],9,-1069501632),a=w(a,r,i,n,s[o+11],14,643717713),n=w(n,a,r,i,s[o],20,-373897302),i=w(i,n,a,r,s[o+5],5,-701558691),r=w(r,i,n,a,s[o+10],9,38016083),a=w(a,r,i,n,s[o+15],14,-660478335),n=w(n,a,r,i,s[o+4],20,-405537848),i=w(i,n,a,r,s[o+9],5,568446438),r=w(r,i,n,a,s[o+14],9,-1019803690),a=w(a,r,i,n,s[o+3],14,-187363961),n=w(n,a,r,i,s[o+8],20,1163531501),i=w(i,n,a,r,s[o+13],5,-1444681467),r=w(r,i,n,a,s[o+2],9,-51403784),a=w(a,r,i,n,s[o+7],14,1735328473),n=w(n,a,r,i,s[o+12],20,-1926607734),i=p(i,n,a,r,s[o+5],4,-378558),r=p(r,i,n,a,s[o+8],11,-2022574463),a=p(a,r,i,n,s[o+11],16,1839030562),n=p(n,a,r,i,s[o+14],23,-35309556),i=p(i,n,a,r,s[o+1],4,-1530992060),r=p(r,i,n,a,s[o+4],11,1272893353),a=p(a,r,i,n,s[o+7],16,-155497632),n=p(n,a,r,i,s[o+10],23,-1094730640),i=p(i,n,a,r,s[o+13],4,681279174),r=p(r,i,n,a,s[o],11,-358537222),a=p(a,r,i,n,s[o+3],16,-722521979),n=p(n,a,r,i,s[o+6],23,76029189),i=p(i,n,a,r,s[o+9],4,-640364487),r=p(r,i,n,a,s[o+12],11,-421815835),a=p(a,r,i,n,s[o+15],16,530742520),n=p(n,a,r,i,s[o+2],23,-995338651),i=T(i,n,a,r,s[o],6,-198630844),r=T(r,i,n,a,s[o+7],10,1126891415),a=T(a,r,i,n,s[o+14],15,-1416354905),n=T(n,a,r,i,s[o+5],21,-57434055),i=T(i,n,a,r,s[o+12],6,1700485571),r=T(r,i,n,a,s[o+3],10,-1894986606),a=T(a,r,i,n,s[o+10],15,-1051523),n=T(n,a,r,i,s[o+1],21,-2054922799),i=T(i,n,a,r,s[o+8],6,1873313359),r=T(r,i,n,a,s[o+15],10,-30611744),a=T(a,r,i,n,s[o+6],15,-1560198380),n=T(n,a,r,i,s[o+13],21,1309151649),i=T(i,n,a,r,s[o+4],6,-145523070),r=T(r,i,n,a,s[o+11],10,-1120210379),a=T(a,r,i,n,s[o+2],15,718787259),n=T(n,a,r,i,s[o+9],21,-343485551),i=P(i,c),n=P(n,l),a=P(a,m),r=P(r,v)}return[i,n,a,r]}function pt(s){if(s.length===0)return[];for(var t=s.length*8,i=new Uint32Array(Ye(t)),n=0;n<t;n+=8)i[n>>5]|=(s[n/8]&255)<<n%32;return i}function P(s,t){var i=(s&65535)+(t&65535),n=(s>>16)+(t>>16)+(i>>16);return n<<16|i&65535}function Tt(s,t){return s<<t|s>>>32-t}function he(s,t,i,n,a,r){return P(Tt(P(P(t,s),P(n,r)),a),i)}function f(s,t,i,n,a,r,o){return he(t&i|~t&n,s,t,a,r,o)}function w(s,t,i,n,a,r,o){return he(t&n|i&~n,s,t,a,r,o)}function p(s,t,i,n,a,r,o){return he(t^i^n,s,t,a,r,o)}function T(s,t,i,n,a,r,o){return he(i^(t|~n),s,t,a,r,o)}var vt=Ne("v3",48,gt);const It=vt;function Ct(s,t,i){s=s||{};var n=s.random||(s.rng||je)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){i=i||0;for(var a=0;a<16;++a)t[i+a]=n[a];return t}return oe(n)}function xt(s,t,i,n){switch(s){case 0:return t&i^~t&n;case 1:return t^i^n;case 2:return t&i^t&n^i&n;case 3:return t^i^n}}function ge(s,t){return s<<t|s>>>32-t}function yt(s){var t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof s=="string"){var n=unescape(encodeURIComponent(s));s=[];for(var a=0;a<n.length;++a)s.push(n.charCodeAt(a))}else Array.isArray(s)||(s=Array.prototype.slice.call(s));s.push(128);for(var r=s.length/4+2,o=Math.ceil(r/16),c=new Array(o),l=0;l<o;++l){for(var m=new Uint32Array(16),v=0;v<16;++v)m[v]=s[l*64+v*4]<<24|s[l*64+v*4+1]<<16|s[l*64+v*4+2]<<8|s[l*64+v*4+3];c[l]=m}c[o-1][14]=(s.length-1)*8/Math.pow(2,32),c[o-1][14]=Math.floor(c[o-1][14]),c[o-1][15]=(s.length-1)*8&4294967295;for(var x=0;x<o;++x){for(var y=new Uint32Array(80),S=0;S<16;++S)y[S]=c[x][S];for(var k=16;k<80;++k)y[k]=ge(y[k-3]^y[k-8]^y[k-14]^y[k-16],1);for(var K=i[0],$=i[1],q=i[2],V=i[3],le=i[4],J=0;J<80;++J){var be=Math.floor(J/20),ze=ge(K,5)+xt(be,$,q,V)+le+t[be]+y[J]>>>0;le=V,V=q,q=ge($,30)>>>0,$=K,K=ze}i[0]=i[0]+K>>>0,i[1]=i[1]+$>>>0,i[2]=i[2]+q>>>0,i[3]=i[3]+V>>>0,i[4]=i[4]+le>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,i[0]&255,i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,i[1]&255,i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,i[2]&255,i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,i[3]&255,i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,i[4]&255]}var Et=Ne("v5",80,yt);const At=Et,St="00000000-0000-0000-0000-000000000000";function Gt(s){if(!re(s))throw TypeError("Invalid UUID");return parseInt(s.substr(14,1),16)}const Mt=Object.freeze(Object.defineProperty({__proto__:null,v1:ct,v3:It,v4:Ct,v5:At,NIL:St,version:Gt,validate:re,stringify:oe,parse:Xe},Symbol.toStringTag,{value:"Module"})),bt=ot(Mt);function Ce(s,t){if(!s||!t||!s.length||!t.length)throw new Error("Bad alphabet");this.srcAlphabet=s,this.dstAlphabet=t}Ce.prototype.convert=function(s){var t,i,n,a={},r=this.srcAlphabet.length,o=this.dstAlphabet.length,c=s.length,l=typeof s=="string"?"":[];if(!this.isValid(s))throw new Error('Number "'+s+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return s;for(t=0;t<c;t++)a[t]=this.srcAlphabet.indexOf(s[t]);do{for(i=0,n=0,t=0;t<c;t++)i=i*r+a[t],i>=o?(a[n++]=parseInt(i/o,10),i=i%o):n>0&&(a[n++]=0);c=n,l=this.dstAlphabet.slice(i,i+1).concat(l)}while(n!==0);return l};Ce.prototype.isValid=function(s){for(var t=0;t<s.length;++t)if(this.srcAlphabet.indexOf(s[t])===-1)return!1;return!0};var Ht=Ce,Rt=Ht;function U(s,t){var i=new Rt(s,t);return function(n){return i.convert(n)}}U.BIN="01";U.OCT="01234567";U.DEC="0123456789";U.HEX="0123456789abcdef";var Pt=U;const{v4:fe}=bt,Z=Pt,we="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ",kt="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#$%&'()*+-./:<=>?@[]^_`{|}~",Ft={consistentLength:!0};let pe;const Pe=(s,t,i)=>{const n=t(s.toLowerCase().replace(/-/g,""));return!i||!i.consistentLength?n:n.padStart(i.shortIdLength,i.paddingChar)},Lt=(s,t)=>{const n=t(s).padStart(32,"0").match(/(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})/);return[n[1],n[2],n[3],n[4],n[5]].join("-")},Bt=s=>Math.ceil(Math.log(2**128)/Math.log(s));var E=(()=>{const s=(t,i)=>{const n=t||we,a={...Ft,...i};if([...new Set(Array.from(n))].length!==n.length)throw new Error("The provided Alphabet has duplicate characters resulting in unreliable results");const r=Bt(n.length),o={shortIdLength:r,consistentLength:a.consistentLength,paddingChar:n[0]},c=Z(Z.HEX,n),l=Z(n,Z.HEX),m=()=>Pe(fe(),c,o),v={new:m,generate:m,uuid:fe,fromUUID:x=>Pe(x,c,o),toUUID:x=>Lt(x,l),alphabet:n,maxLength:r};return Object.freeze(v),v};return s.constants={flickrBase58:we,cookieBase90:kt},s.uuid=fe,s.generate=()=>(pe||(pe=s(we).generate),pe()),s})();const ke=(s,t)=>Math.hypot(s.x-t.x,s.y-t.y);class xe{constructor(t,i,n,a){e(this,"id");e(this,"x");e(this,"y");e(this,"tileMiddle");e(this,"range");e(this,"attackSpeed");e(this,"attackSpeedThrottleTime");e(this,"image");e(this,"sWidth",64);e(this,"sHeight",this.sWidth);e(this,"dWidth",64);e(this,"dHeight",this.dWidth);e(this,"dX");e(this,"dY");e(this,"imgConfig");e(this,"frameIteration",0);e(this,"frameIterationThrottleTime",100);e(this,"cancelAttackAnimantionAllowed");e(this,"projectileImg");e(this,"projectileWidth");e(this,"projectileHeight");e(this,"projectiles",[]);e(this,"state",C.IDLE);e(this,"animationDirection",u.LEFT);e(this,"showRange",!1);e(this,"updateImgConfig",!1);e(this,"newAnimationCycle",!0);e(this,"sX",null);e(this,"sY",null);e(this,"frames",null);e(this,"flipOffsetFrames",null);e(this,"lastFrameIteration",null);e(this,"lastAttack",null);e(this,"currentTarget",null);e(this,"targetFallbackCoordinates",null);e(this,"getImgConfigForState",()=>{let t;switch(this.state){case C.IDLE:t=this.imgConfig.idle;break;default:t=this.imgConfig.attack}return t});e(this,"setImageConfig",()=>{const{animationStartRight:t,animationStartLeft:i,frames:n,animationIterationCircleTime:a,flipOffsetFrames:r}=this.getImgConfigForState();this.sX=this.animationDirection===u.RIGHT?t.sx:i.sx,this.sY=this.animationDirection===u.RIGHT?t.sy:i.sy,this.frames=n,this.flipOffsetFrames=r,this.frameIterationThrottleTime=a/this.frames});e(this,"setSxFrame",()=>{if(this.frames===null||this.flipOffsetFrames===null)throw new Error("Frames or flipOffsetFrames is null");this.animationDirection===u.RIGHT?this.sX=this.frameIteration*this.sWidth:this.sX=(this.frames+this.flipOffsetFrames)*this.sWidth-(this.frameIteration+1)*this.sWidth});e(this,"shoot",()=>{this.lastAttack=performance.now()});e(this,"setFrameIteration",()=>{if(this.frames===null)throw new Error("Frames is null");this.frameIteration<this.frames-1?this.frameIteration++:(this.frameIteration=0,this.newAnimationCycle=!0,this.state===C.ATTACK&&(this.state=C.IDLE,this.setImageConfig(),this.targetFallbackCoordinates=null))});e(this,"drawImg",()=>{this.sX!==null&&this.sY!==null&&h.ctxGame.drawImage(this.image,this.sX,this.sY,this.sWidth,this.sHeight,this.dX,this.dY,this.dWidth,this.dHeight)});e(this,"idleAnimation",()=>{this.drawImg()});e(this,"setStateAndCurrentTarget",t=>{this.currentTarget=t,!(t===null&&this.state===C.ATTACK&&!this.cancelAttackAnimantionAllowed)&&(this.newAnimationCycle=!0,this.frameIteration=0,t===null?(this.state=C.IDLE,this.setImageConfig()):(this.state=C.ATTACK,this.setAnimationDirection(),this.setImageConfig()))});e(this,"findNextTarget",()=>{let t=null,i=1/0;return d.enemies.getCurrentEnemies().forEach(n=>{const a=ke(this.tileMiddle,{x:n.x,y:n.y});a<=this.range&&a<=i&&(i=a,t=n)}),t});e(this,"checkAndSetClosestEnemyInRange",()=>{if(this.currentTargetIsInRage())this.setStateAndCurrentTarget(this.currentTarget);else{const t=this.findNextTarget();t!==null&&this.setStateAndCurrentTarget(t)}});e(this,"currentTargetIsInRage",()=>this.currentTarget?!(ke(this.tileMiddle,{x:this.currentTarget.x,y:this.currentTarget.y})>this.range):!1);e(this,"setAnimationDirection",()=>{if(this.currentTarget===null)throw new Error("No current target");this.currentTarget.x<=this.x?this.animationDirection===u.RIGHT&&(this.animationDirection=u.LEFT,this.updateImgConfig=!0):this.animationDirection===u.LEFT&&(this.animationDirection=u.RIGHT,this.updateImgConfig=!0)});e(this,"attackAnimation",()=>{this.drawImg()});e(this,"updateProjectiles",()=>{this.projectiles.forEach(t=>t.update())});e(this,"removeProjectile",t=>{this.projectiles=this.projectiles.filter(i=>i.id!==t)});e(this,"removeTarget",()=>{this.setStateAndCurrentTarget(null)});e(this,"drawRange",()=>{h.ctxGame.beginPath(),h.ctxGame.arc(this.tileMiddle.x,this.tileMiddle.y,this.range,0,Math.PI*2),h.ctxGame.fillStyle="rgba(225,225,225,0.1)",h.ctxGame.fill()});e(this,"setShowRange",t=>{this.showRange=t});e(this,"shootAtAttackAnimationFrame",(t,i)=>{this.targetFallbackCoordinates===null&&this.currentTarget!==null&&(this.targetFallbackCoordinates={x:this.currentTarget.x,y:this.currentTarget.y}),A(this.lastAttack,this.attackSpeedThrottleTime)&&this.frameIteration===t&&(this.shoot(),this.projectiles.push(i()))});e(this,"updateFrames",()=>{this.newAnimationCycle===!0?(this.setSxFrame(),this.lastFrameIteration=performance.now(),this.newAnimationCycle=!1):A(this.lastFrameIteration,this.frameIterationThrottleTime)&&(this.setFrameIteration(),this.setSxFrame(),this.lastFrameIteration=performance.now())});this.id=t,this.x=i,this.y=n,this.tileMiddle=We({x:i,y:n}),this.range=a.range,this.attackSpeed=a.attackSpeed,this.attackSpeedThrottleTime=60/this.attackSpeed*1e3,this.cancelAttackAnimantionAllowed=a.cancelAttackAnimantionAllowed,this.image=N.imageController.getImage(a.id),this.imgConfig=a.frameConfig,this.dX=i,this.dY=n,this.setImageConfig(),this.projectileImg=N.imageController.getImage(a.projectile.id),this.projectileWidth=a.projectile.width,this.projectileHeight=a.projectile.height}}const Y=(s,t,i,n)=>{const a=n-t,r=i-s;let o=Math.atan2(a,r);return o*=180/Math.PI,o},Ie=({center:s,radius:t,target:i})=>Math.sqrt(Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2))<=t;class Wt{constructor(t,i,n,a,r,o){e(this,"id");e(this,"x");e(this,"y");e(this,"radius");e(this,"damage");e(this,"damageOverTimeThrottleTime");e(this,"affectedEnemies",[]);e(this,"isAffectedEnemy",t=>this.affectedEnemies.find(i=>i.enemy===t));e(this,"updateEnemiesInsideArea",()=>{d.enemies.getCurrentEnemies().forEach(t=>{if(Ie({center:{x:this.x,y:this.y},radius:this.radius,target:{x:t.x,y:t.y}})&&!this.isAffectedEnemy(t))this.affectedEnemies.push({enemy:t,damageHitTime:null});else if(!Ie({center:{x:this.x,y:this.y},radius:this.radius,target:{x:t.x,y:t.y}})&&this.isAffectedEnemy(t)){const i=this.affectedEnemies.map(n=>n.enemy).indexOf(t);this.affectedEnemies.splice(i,1)}}),this.affectedEnemies.forEach(t=>{if(!d.enemies.getCurrentEnemies().includes(t.enemy)){const i=this.affectedEnemies.indexOf(t);this.affectedEnemies.splice(i,1)}})});e(this,"damageEnemies",()=>{this.affectedEnemies.forEach(t=>{(t.damageHitTime===null||A(t.damageHitTime,this.damageOverTimeThrottleTime))&&(t.enemy.reduceHealth(this.damage),t.damageHitTime=performance.now())})});e(this,"update",()=>{this.updateEnemiesInsideArea(),this.damageEnemies()});this.id=t,this.x=i,this.y=n,this.radius=a,this.damage=r,this.damageOverTimeThrottleTime=o}}class Ot{constructor(t,i,n,a,r,o,c,l){e(this,"id");e(this,"x");e(this,"y");e(this,"damage");e(this,"image");e(this,"sWidth",74);e(this,"sHeight",44);e(this,"dWidth",74);e(this,"dHeight",44);e(this,"sY",0);e(this,"target");e(this,"animationDirection");e(this,"angle");e(this,"removeProjectile");e(this,"damageOverTimeArea");e(this,"damageOverTimeThrottleTime",400);e(this,"damageOverTimeRadius",20);e(this,"frameIteration",0);e(this,"frames",8);e(this,"animationIterationCircleTime",800);e(this,"sX",null);e(this,"frameIterationThrottleTime",this.animationIterationCircleTime/this.frames);e(this,"lastFrameIteration",null);e(this,"setFrameIteration",()=>{this.frameIteration++});e(this,"setSxFrame",()=>{this.animationDirection===u.RIGHT?this.sX=this.frameIteration*this.sWidth:this.sX=this.frames*this.sWidth-(this.frameIteration+1)*this.sWidth});e(this,"getHandPosition",()=>this.animationDirection===u.RIGHT?[this.x+20,this.y-5]:[this.x-20,this.y-5]);e(this,"draw",()=>{if(this.sX===null||this.sY===null)throw new Error("sX or sY is null");if(this.frameIteration===this.frames)throw new Error("frameIteration is equal to frames");h.ctxGame.save(),h.ctxGame.translate(...this.getHandPosition()),h.ctxGame.rotate(this.angle*(Math.PI/180)),h.ctxGame.drawImage(this.image,this.sX,this.sY,this.sWidth,this.sHeight,0,-25,this.dWidth,this.dHeight),h.ctxGame.restore()});e(this,"updatedamageOverTimeArea",()=>{this.damageOverTimeArea.update()});e(this,"updateFrames",()=>{if(this.lastFrameIteration===null)this.setSxFrame(),this.lastFrameIteration=performance.now();else if(A(this.lastFrameIteration,this.frameIterationThrottleTime)){if(this.setFrameIteration(),this.frameIteration===this.frames)return this.removeProjectile(this.id),!1;this.setSxFrame(),this.lastFrameIteration=performance.now()}return!0});e(this,"update",()=>{this.updateFrames()!==!1&&(this.draw(),this.updatedamageOverTimeArea())});this.id=t,this.x=i,this.y=n,this.damage=a,this.image=r,this.target=o,this.animationDirection=c,this.angle=Y(this.x,this.y,this.target.x,this.target.y),this.removeProjectile=l,this.damageOverTimeArea=new Wt(E.generate(),this.target.x,this.target.y,this.damageOverTimeRadius,this.damage,this.damageOverTimeThrottleTime)}}const ee=class extends xe{constructor(i,n,a){super(i,n,a,ee.config);e(this,"getProjectile",()=>{if(this.targetFallbackCoordinates===null)throw new Error("No current target");return new Ot(E.generate(),this.tileMiddle.x,this.tileMiddle.y,ee.config.damage,this.projectileImg,this.currentTarget||this.targetFallbackCoordinates,this.animationDirection,this.removeProjectile)});e(this,"update",()=>{this.updateFrames(),this.state===C.ATTACK&&(this.attackAnimation(),this.shootAtAttackAnimationFrame(0,()=>this.getProjectile())),this.state===C.IDLE&&(this.idleAnimation(),A(this.lastAttack,this.attackSpeedThrottleTime)&&this.checkAndSetClosestEnemyInRange()),this.showRange&&this.drawRange(),this.updateProjectiles()})}};let G=ee;e(G,"config",{id:F.FIRE_MAGE,range:100,attackSpeed:40,damage:20,imageScale:.8,frameConfig:{idle:{frames:4,animationIterationCircleTime:500,flipOffsetFrames:0,animationStartRight:{sx:0,sy:0},animationStartLeft:{sx:448,sy:128}},attack:{frames:4,animationIterationCircleTime:800,flipOffsetFrames:0,animationStartRight:{sx:0,sy:64},animationStartLeft:{sx:448,sy:192}}},cancelAttackAnimantionAllowed:!1,projectile:{id:se.FIRE_MAGE,width:40,height:5},bluePrint:{id:ne.FIRE_MAGE}});const Ue=({x:s,y:t},{x:i,y:n})=>(s-i-1)*(s-i+1)<=0&&(t-n-1)*(t-n+1)<=0;class Dt{constructor(t,i,n,a,{img:r,width:o,height:c},l,m){e(this,"id");e(this,"x");e(this,"y");e(this,"damage");e(this,"targetEnemy");e(this,"removeProjectile");e(this,"speed",20);e(this,"image");e(this,"width");e(this,"height");e(this,"draw",()=>{const t=Y(this.x,this.y,this.targetEnemy.x,this.targetEnemy.y);h.ctxGame.save(),h.ctxGame.translate(this.x,this.y),h.ctxGame.rotate(t*(Math.PI/180)),h.ctxGame.drawImage(this.image,-this.width,-this.height),h.ctxGame.restore()});e(this,"move",()=>{const t=Y(this.x,this.y,this.targetEnemy.x,this.targetEnemy.y),i=Math.abs(this.targetEnemy.x-this.x);i-this.speed<0?this.x+=i*Math.cos(t*Math.PI/180):this.x+=this.speed*Math.cos(t*Math.PI/180);const n=Math.abs(this.targetEnemy.y-this.y);n-this.speed<0?this.y+=n*Math.sin(t*Math.PI/180):this.y+=this.speed*Math.sin(t*Math.PI/180),Ue({x:this.x,y:this.y},{x:this.targetEnemy.x,y:this.targetEnemy.y})&&this.collide()});e(this,"collide",()=>{this.removeProjectile(this.id),this.targetEnemy.reduceHealth(this.damage)});e(this,"update",()=>{this.move(),this.draw()});this.id=t,this.x=i,this.y=n,this.damage=a,this.image=r,this.width=o,this.height=c,this.targetEnemy=l,this.removeProjectile=m}}const te=class extends xe{constructor(i,n,a){super(i,n,a,te.config);e(this,"getProjectile",()=>{if(this.currentTarget===null)throw new Error("No current target");return new Dt(E.generate(),this.tileMiddle.x,this.tileMiddle.y,te.config.damage,{img:this.projectileImg,width:this.projectileWidth,height:this.projectileHeight},this.currentTarget,this.removeProjectile)});e(this,"update",()=>{this.updateFrames(),this.state===C.ATTACK&&(this.attackAnimation(),this.shootAtAttackAnimationFrame(6,()=>this.getProjectile())),this.state===C.IDLE&&(this.idleAnimation(),A(this.lastAttack,this.attackSpeedThrottleTime)&&this.checkAndSetClosestEnemyInRange()),this.showRange&&this.drawRange(),this.updateProjectiles()})}};let M=te;e(M,"config",{id:F.ARCANE_ARCHER,range:250,attackSpeed:60,damage:5,imageScale:.8,frameConfig:{idle:{frames:4,animationIterationCircleTime:600,flipOffsetFrames:4,animationStartRight:{sx:0,sy:320},animationStartLeft:{sx:448,sy:832}},attack:{frames:7,animationIterationCircleTime:400,flipOffsetFrames:1,animationStartRight:{sx:0,sy:192},animationStartLeft:{sx:448,sy:704}}},cancelAttackAnimantionAllowed:!0,projectile:{id:se.ARCANE_ARCHER,width:40,height:5},bluePrint:{id:ne.ARCANE_ARCHER}});class jt{constructor(t,i,n,a,r){e(this,"id");e(this,"x");e(this,"y");e(this,"radius");e(this,"damage");e(this,"enemiesInsideArea",[]);e(this,"setEnemiesInsideArea",()=>{this.enemiesInsideArea=d.enemies.getCurrentEnemies().filter(t=>Ie({center:{x:this.x,y:this.y},radius:this.radius,target:{x:t.x,y:t.y}}))});e(this,"damageEnemiesInsideArea",()=>{this.enemiesInsideArea.forEach(t=>{t.reduceHealth(this.damage)})});e(this,"getEnemiesInsideArea",()=>this.enemiesInsideArea);this.id=t,this.x=i,this.y=n,this.radius=a,this.damage=r,this.setEnemiesInsideArea(),this.damageEnemiesInsideArea()}}class Xt{constructor(t,i){e(this,"id");e(this,"slowStart");e(this,"slowPercentage");e(this,"slowDuration");this.id=E.generate(),this.slowStart=performance.now(),this.slowPercentage=t,this.slowDuration=i}}class Nt extends jt{constructor(i,n,a,r,o){super(i,n,a,r,o);e(this,"slowEnemiesInsideArea",()=>{this.getEnemiesInsideArea().forEach(i=>{i.addSlow(new Xt(30,2e3))})});this.slowEnemiesInsideArea()}}class Yt{constructor(t,i,n,a,r,o,c){e(this,"id");e(this,"x");e(this,"y");e(this,"damage");e(this,"image");e(this,"sWidth",150);e(this,"sHeight",192);e(this,"dWidth",150);e(this,"dHeight",192);e(this,"sY",0);e(this,"dX");e(this,"dY");e(this,"removeProjectile");e(this,"radius",70);e(this,"frameIteration",0);e(this,"frames",7);e(this,"animationIterationCircleTime",600);e(this,"sX",null);e(this,"frameIterationThrottleTime",this.animationIterationCircleTime/this.frames);e(this,"lastFrameIteration",null);e(this,"setFrameIteration",()=>{this.frameIteration++});e(this,"setSxFrame",()=>{this.sX=this.frameIteration*this.sWidth});e(this,"draw",()=>{if(this.sX===null||this.sY===null)throw new Error("sX or sY is null");if(this.frameIteration===this.frames)throw new Error("frameIteration is equal to frames");h.ctxGame.drawImage(this.image,this.sX,this.sY,this.sWidth,this.sHeight,this.dX-this.dWidth/2,this.dY-this.dHeight/1.35,this.dWidth,this.dHeight)});e(this,"updateFrames",()=>{if(this.lastFrameIteration===null)this.setSxFrame(),this.lastFrameIteration=performance.now();else if(A(this.lastFrameIteration,this.frameIterationThrottleTime)){if(this.setFrameIteration(),this.frameIteration===this.frames)return this.removeProjectile(this.id),!1;this.setSxFrame(),this.lastFrameIteration=performance.now()}return!0});e(this,"update",()=>{this.updateFrames()!==!1&&this.draw()});this.id=t,this.x=i,this.y=n,this.damage=a,this.image=r,this.dX=o.x,this.dY=o.y,this.removeProjectile=c,new Nt(E.generate(),this.dX,this.dY,this.radius,this.damage)}}const ie=class extends xe{constructor(i,n,a){super(i,n,a,ie.config);e(this,"getProjectile",()=>{if(this.targetFallbackCoordinates===null)throw new Error("No current target");return new Yt(E.generate(),this.tileMiddle.x,this.tileMiddle.y,ie.config.damage,this.projectileImg,this.currentTarget||this.targetFallbackCoordinates,this.removeProjectile)});e(this,"update",()=>{this.updateFrames(),this.state===C.ATTACK&&(this.attackAnimation(),this.shootAtAttackAnimationFrame(10,()=>this.getProjectile())),this.state===C.IDLE&&(this.idleAnimation(),A(this.lastAttack,this.attackSpeedThrottleTime)&&this.checkAndSetClosestEnemyInRange()),this.showRange&&this.drawRange(),this.updateProjectiles()})}};let b=ie;e(b,"config",{id:F.Lightning_MAGE,range:200,attackSpeed:30,damage:10,imageScale:1,frameConfig:{idle:{frames:8,animationIterationCircleTime:800,flipOffsetFrames:8,animationStartRight:{sx:0,sy:0},animationStartLeft:{sx:960,sy:128}},attack:{frames:16,animationIterationCircleTime:1e3,flipOffsetFrames:0,animationStartRight:{sx:0,sy:64},animationStartLeft:{sx:960,sy:192}}},cancelAttackAnimantionAllowed:!1,projectile:{id:se.LIGHTNING_MAGE,width:40,height:5},bluePrint:{id:ne.LIGHTNING_MAGE}});const ye=class{constructor(){e(this,"selectedTower",null);e(this,"getSelectedTower",()=>this.selectedTower);e(this,"setSelectedTower",t=>{this.selectedTower=t});e(this,"selectTower",t=>{this.setSelectedTower(t),h.body.removeAllClassesFromBody(),t!==null&&h.body.addTowerMouseCursor(t)});ye.towers.forEach(t=>{new rt(t,this.selectTower)})}};let _=ye;e(_,"towers",[{id:M.config.id,name:"Arcane Archer",range:M.config.range,blueprintId:M.config.bluePrint.id,price:50,damage:M.config.damage,attackSpeed:M.config.attackSpeed},{id:G.config.id,name:"Fire Mage",range:G.config.range,blueprintId:G.config.bluePrint.id,price:100,damage:G.config.damage,attackSpeed:G.config.attackSpeed},{id:b.config.id,name:"Lightning Mage",range:b.config.range,blueprintId:b.config.bluePrint.id,price:100,damage:b.config.damage,attackSpeed:b.config.attackSpeed}]);class Ut{constructor(){e(this,"startHealth",100);e(this,"currentHealth",this.startHealth);e(this,"menuItem");e(this,"getCurrentHealth",()=>this.currentHealth);e(this,"reduceHealth",(t=10)=>{this.currentHealth-=t,this.update()});e(this,"update",()=>{this.menuItem.innerHTML=`Health: <br>${this.currentHealth}`});this.menuItem=document.createElement("div"),this.menuItem.classList.add("menu-item","menu-item-stats"),this.menuItem.id="menu-item-health",this.menuItem.innerHTML=`Health: <br>${this.currentHealth}`,h.menuContainer.addMenuItemPlayerHealth(this.menuItem)}}class zt{constructor(t){e(this,"game");e(this,"container");e(this,"headline");e(this,"scaleInTransformIn",[{transform:"translate(-50%, -50%) scale(0.5)"},{transform:"translate(-50%, -50%) scale(1)"}]);e(this,"scaleInTransformOut",[{transform:"translate(-50%, -50%) scale(1)"},{transform:"translate(-50%, -50%) scale(0.5)"}]);e(this,"scaleInTiming",100);e(this,"remove",()=>{this.container.animate(this.scaleInTransformOut,this.scaleInTiming),setTimeout(()=>{this.container.remove()},this.scaleInTiming)});e(this,"createGoldIncreaseText",(t,i)=>{const n=document.createElement("p");n.classList.add("round-complete-text");const a=document.createElement("span");a.classList.add("round-complete-text-key");const r=document.createElement("span");r.classList.add("round-complete-text-value"),a.innerHTML=t,r.innerHTML=i,n.appendChild(a),n.appendChild(r),this.container.appendChild(n)});this.game=t,this.container=document.createElement("div"),this.container.id="round-complete-container",this.container.classList.add("box-shadow"),this.headline=document.createElement("h2"),this.headline.id="round-complete-headline",this.headline.innerHTML="Wave Defeated",this.container.appendChild(this.headline);const i=this.game.gold.getCollectedBountyGoldPerRound(),n=this.game.gold.getPercentageGoldIncreasePerRound(),a=this.game.gold.staticGoldIncrease,r=i+n+a;this.createGoldIncreaseText("Bounty Gold this round:",i.toString()),this.createGoldIncreaseText("10% of current Gold:",n.toString()),this.createGoldIncreaseText("Static Gold increase:",a.toString()),this.createGoldIncreaseText("Total Gold increase:",r.toString()),document.body.appendChild(this.container),this.container.animate(this.scaleInTransformIn,this.scaleInTiming),setTimeout(()=>{this.remove()},5e3)}}class Kt{constructor(t,i,n){e(this,"container");e(this,"headlineEl");e(this,"bountyGoldEl");e(this,"countdownEl");e(this,"countdownCurrent");e(this,"countdownStart",5);e(this,"interval");e(this,"scaleInTransformRemove",[{transform:"translateX(0)"},{transform:"translateX(-100%)"}]);e(this,"scaleInTimingRemove",300);e(this,"scaleInTransformSpawn",[{transform:"translateX(-100%)"},{transform:"translateX(0)"}]);e(this,"scaleInTimingSpawn",300);e(this,"startWave");e(this,"countdown",()=>{if(this.countdownCurrent<0){this.container.animate(this.scaleInTransformRemove,this.scaleInTimingRemove),setTimeout(()=>{this.container.remove()},this.scaleInTimingRemove),clearInterval(this.interval);return}if(this.countdownCurrent===0){this.countdownEl.innerHTML="Start!",this.countdownCurrent--,this.startWave();return}this.countdownCurrent>=4&&(this.countdownEl.innerHTML="&nbsp;"),this.countdownCurrent>0&&this.countdownCurrent<4&&(this.countdownEl.innerHTML=this.countdownCurrent.toString()),this.countdownCurrent--});this.startWave=n,this.container=document.createElement("div"),this.container.id="spawn-enemies-container",this.container.classList.add("box-shadow"),this.headlineEl=document.createElement("h2"),this.headlineEl.id="spawn-enemies-headline",this.headlineEl.innerHTML=t,this.bountyGoldEl=document.createElement("h3"),this.bountyGoldEl.id="spawn-enemies-bounty-gold",this.bountyGoldEl.innerHTML=`Bounty Gold: ${i.toString()}`,this.countdownCurrent=this.countdownStart,this.countdownEl=document.createElement("h2"),this.countdownEl.id="spawn-enemies-countdown",this.countdownEl.innerHTML="&nbsp;",this.interval=setInterval(this.countdown,1e3),this.container.appendChild(this.headlineEl),this.container.appendChild(this.bountyGoldEl),this.container.appendChild(this.countdownEl),document.body.appendChild(this.container),this.container.animate(this.scaleInTransformSpawn,this.scaleInTimingSpawn)}}class $t{constructor(t){e(this,"game");e(this,"waveIsScheduled",!1);e(this,"initialWave",!0);e(this,"spawnEnemies",()=>{const{currentEnemies:t,name:i,bountyGold:n}=this.game.waves.createEnemyWave(),a=()=>{this.game.enemies.setCurrentEnemies(t),this.waveIsScheduled=!1,this.game.gold.resetDynamicGoldIncreasePerRound()};new Kt(i,n,a)});e(this,"update",()=>{if(!this.waveIsScheduled&&this.game.enemies.allEnemiesRemoved){if(this.game.waves.wasLastWave){this.game.stopGame(),new De(ae.WON);return}if(this.initialWave){this.initialWave=!1,setTimeout(()=>{this.spawnEnemies()},1e3),this.waveIsScheduled=!0;return}this.game.gold.increaseGoldAfterRound(),new zt(this.game),setTimeout(()=>{this.spawnEnemies()},6e3),this.waveIsScheduled=!0}});this.game=t}}const qt=(s,t,i)=>{switch(s){case F.ARCANE_ARCHER:return new M(E.generate(),t,i);case F.FIRE_MAGE:return new G(E.generate(),t,i);case F.Lightning_MAGE:return new b(E.generate(),t,i);default:throw new Error("Tower not found")}};class Vt{constructor(){e(this,"towers",[]);e(this,"updateTowers",()=>{this.towers.forEach(t=>t.update())});e(this,"resetTowerTarget",t=>{this.towers.forEach(i=>{var n;((n=i.currentTarget)==null?void 0:n.id)===t&&i.removeTarget()})});e(this,"createTower",(t,i,n)=>{this.towers.push(qt(n.id,t,i))});e(this,"getTowerForTile",(t,i)=>this.towers.find(n=>n.x===t&&n.y===i));e(this,"hideTowerRange",()=>{this.towers.forEach(t=>t.setShowRange(!1))});e(this,"update",()=>{this.updateTowers()})}}const Jt=s=>Math.floor(Math.random()*s);class z{constructor(t,i,n,a){e(this,"id");e(this,"x");e(this,"y");e(this,"image");e(this,"frameConfig");e(this,"sWidth");e(this,"sHeight");e(this,"imageTranslateX");e(this,"imageTranslateY");e(this,"dWidth");e(this,"dHeight");e(this,"health");e(this,"speed");e(this,"maxSlowPercentage");e(this,"bountyGold");e(this,"state",ve.MOVE);e(this,"animationDirection",u.RIGHT);e(this,"frameIteration",null);e(this,"frames",null);e(this,"flipOffsetFrames",null);e(this,"sX",null);e(this,"sY",null);e(this,"frameIterationThrottleTime",null);e(this,"lastFrameIteration",null);e(this,"nodeTarget");e(this,"pathNodes");e(this,"angle");e(this,"nodesIndex",0);e(this,"slows",[]);e(this,"getImgConfigForState",()=>{switch(this.state){case ve.MOVE:return this.frameConfig.move;default:return this.frameConfig.move}});e(this,"setImageConfig",()=>{const{animationStartRight:t,animationStartLeft:i,frames:n,animationIterationCircleTime:a,flipOffsetFrames:r}=this.getImgConfigForState();this.sY=this.animationDirection===u.RIGHT?t.sy:i.sy,this.frames=n,this.flipOffsetFrames=r,this.frameIterationThrottleTime=a/this.frames,this.frameIteration=Jt(this.frames)});e(this,"setFrameIteration",()=>{if(this.frames===null||this.frameIteration===null)throw new Error("frames or frameIteration is null");this.frameIteration<this.frames-1?this.frameIteration++:this.frameIteration=0});e(this,"setSxFrame",()=>{if(this.frames===null||this.flipOffsetFrames===null||this.frameIteration===null)throw new Error("frames or flipOffsetFrames or frameIteration is null");this.animationDirection===u.RIGHT?this.sX=this.frameIteration*this.sWidth:this.sX=(this.frames+this.flipOffsetFrames)*this.sWidth-(this.frameIteration+1)*this.sWidth});e(this,"draw",()=>{if(this.sX===null||this.sY===null)throw new Error("sX or sY is null");if(this.frameIteration===this.frames)throw new Error("frameIteration is equal to frames");h.ctxGame.drawImage(this.image,this.sX,this.sY,this.sWidth,this.sHeight,this.x-this.imageTranslateX,this.y-this.imageTranslateY,this.dWidth,this.dHeight)});e(this,"addSlow",t=>{this.slows.push(t)});e(this,"updateSlows",()=>{const t=performance.now();this.slows.forEach(i=>{t-i.slowStart>=i.slowDuration&&(this.slows=this.slows.filter(n=>n.id!==i.id))})});e(this,"getCurrentSpeed",()=>{if(this.slows.length===0)return this.speed;const t=this.slows.reduce((n,a)=>n+a.slowPercentage,0),i=t>this.maxSlowPercentage?this.maxSlowPercentage:t;return this.speed*((100-i)/100)});e(this,"move",()=>{const t=this.getCurrentSpeed(),i=Math.abs(this.nodeTarget.x-this.x);i-t<0?this.x+=i*Math.cos(this.angle*Math.PI/180):this.x+=t*Math.cos(this.angle*Math.PI/180);const n=Math.abs(this.nodeTarget.y-this.y);n-t<0?this.y+=n*Math.sin(this.angle*Math.PI/180):this.y+=t*Math.sin(this.angle*Math.PI/180),Ue({x:this.x,y:this.y},{x:this.nodeTarget.x,y:this.nodeTarget.y})&&(this.updateNodeTarget(),this.updateAnimationDirection(),this.setImageConfig(),this.reduceBountyGold())});e(this,"updateNodeTarget",()=>{if(this.nodesIndex++,this.pathNodes.length===this.nodesIndex){d.playerHealth.reduceHealth(),d.enemies.remove(this.id);return}this.nodeTarget=this.pathNodes[this.nodesIndex],this.angle=Y(this.x,this.y,this.nodeTarget.x,this.nodeTarget.y)});e(this,"updateAnimationDirection",()=>{this.x===this.nodeTarget.x&&(this.animationDirection=Math.random()<.5?u.RIGHT:u.LEFT),this.x<this.nodeTarget.x&&(this.animationDirection=u.RIGHT),this.x>this.nodeTarget.x&&(this.animationDirection=u.LEFT)});e(this,"updateFrames",()=>{if(this.lastFrameIteration===null)this.setSxFrame(),this.lastFrameIteration=performance.now();else{if(this.frameIterationThrottleTime===null)throw new Error("frameIterationThrottleTime is null");A(this.lastFrameIteration,this.frameIterationThrottleTime)&&(this.setFrameIteration(),this.setSxFrame(),this.lastFrameIteration=performance.now())}});e(this,"reduceBountyGold",()=>{this.bountyGold=Math.round(this.bountyGold*.9)});e(this,"reduceHealth",t=>{this.health-=t,this.health<=0&&(d.enemies.remove(this.id),d.gold.increaseGoldAfterKillEnemy(this.bountyGold),d.towers.resetTowerTarget(this.id))});e(this,"update",()=>{this.updateFrames(),this.updateSlows(),this.move(),this.draw()});this.id=t,this.x=i,this.y=n,this.image=N.imageController.getImage(a.id),this.sWidth=a.sWidth,this.sHeight=a.sHeight,this.dWidth=a.imageScale*a.sWidth,this.dHeight=a.imageScale*a.sHeight,this.imageTranslateX=a.sWidth/2-a.imageTranslateCorrection.x,this.imageTranslateY=a.sHeight/2-a.imageTranslateCorrection.y,this.frameConfig=a.frameConfig,this.health=a.health,this.speed=a.speed,this.maxSlowPercentage=a.maxSlowPercentage,this.bountyGold=a.bountyGold,this.setImageConfig(),this.pathNodes=H.getPathNodes(),this.nodeTarget=this.pathNodes[this.nodesIndex],this.angle=Y(this.x,this.y,this.nodeTarget.x,this.nodeTarget.y)}}const Ee=class extends z{constructor(t,i,n){super(t,i,n,Ee.config)}};let W=Ee;e(W,"config",{id:"skeletonShield",health:10,speed:2,maxSlowPercentage:50,sWidth:64,sHeight:64,imageScale:.8,imageTranslateCorrection:{x:5,y:-10},frameConfig:{move:{frames:4,animationIterationCircleTime:500,flipOffsetFrames:0,animationStartRight:{sx:0,sy:64},animationStartLeft:{sx:192,sy:384}}},bountyGold:5});const Ae=class extends z{constructor(t,i,n){super(t,i,n,Ae.config)}};let O=Ae;e(O,"config",{id:"mushroom",health:30,speed:2,maxSlowPercentage:80,sWidth:64,sHeight:64,imageScale:1,imageTranslateCorrection:{x:0,y:-20},frameConfig:{move:{frames:8,animationIterationCircleTime:500,flipOffsetFrames:0,animationStartRight:{sx:0,sy:64},animationStartLeft:{sx:192,sy:320}}},bountyGold:5});const Se=class extends z{constructor(t,i,n){super(t,i,n,Se.config)}};let D=Se;e(D,"config",{id:"goblin",health:40,speed:3,maxSlowPercentage:50,sWidth:64,sHeight:64,imageScale:1.1,imageTranslateCorrection:{x:-5,y:-25},frameConfig:{move:{frames:8,animationIterationCircleTime:500,flipOffsetFrames:0,animationStartRight:{sx:0,sy:64},animationStartLeft:{sx:192,sy:320}}},bountyGold:10});const Ge=class extends z{constructor(t,i,n){super(t,i,n,Ge.config)}};let j=Ge;e(j,"config",{id:"fireWorm",health:100,speed:2,maxSlowPercentage:20,sWidth:64,sHeight:64,imageScale:1,imageTranslateCorrection:{x:0,y:-10},frameConfig:{move:{frames:9,animationIterationCircleTime:500,flipOffsetFrames:0,animationStartRight:{sx:0,sy:0},animationStartLeft:{sx:512,sy:192}}},bountyGold:15});const Me=class extends z{constructor(t,i,n){super(t,i,n,Me.config)}};let X=Me;e(X,"config",{id:"demon",health:600,speed:1,maxSlowPercentage:0,sWidth:110,sHeight:110,imageScale:.8,imageTranslateCorrection:{x:15,y:-25},frameConfig:{move:{frames:12,animationIterationCircleTime:1e3,flipOffsetFrames:0,animationStartRight:{sx:0,sy:0},animationStartLeft:{sx:1210,sy:110}}},bountyGold:100});const B=class{constructor(){e(this,"waveIndex",0);e(this,"wasLastWave",!1);e(this,"createEnemyWave",()=>{if(this.waveIndex>=B.waves.length)throw new Error("No more waves available");const{className:t,unitCount:i,name:n,bountyGold:a}=B.waves[this.waveIndex],r=[];for(let o=0;o<i;o++){const{x:c,y:l}=B.waveStartingPositions[o];r.push(new t(E.generate(),c,l))}return this.waveIndex++,this.waveIndex>=B.waves.length&&(this.wasLastWave=!0),{currentEnemies:r,name:n,bountyGold:a}})}};let L=B;e(L,"waves",[{id:W.config.id,name:"Shielded Skeleton",className:W,unitCount:12,bountyGold:W.config.bountyGold},{id:O.config.id,name:"Mad Mushroom",className:O,unitCount:12,bountyGold:O.config.bountyGold},{id:D.config.id,name:"Greedy Goblin",className:D,unitCount:12,bountyGold:D.config.bountyGold},{id:j.config.id,name:"Fire Worm",className:j,unitCount:12,bountyGold:j.config.bountyGold},{id:X.config.id,name:"Demon",className:X,unitCount:1,bountyGold:X.config.bountyGold}]),e(L,"waveStartingPositions",[{x:40,y:160},{x:0,y:160},{x:-40,y:160},{x:-80,y:160},{x:-120,y:160},{x:-160,y:160},{x:-200,y:160},{x:-240,y:160},{x:-280,y:160},{x:-320,y:160},{x:-360,y:160},{x:-400,y:160}]);L.waves.map(s=>s.name);class Qt{constructor(){e(this,"stop",!1);e(this,"lastAnimationTimestamp",null);e(this,"fps",60);e(this,"intervalInMiliseconds",1e3/this.fps);e(this,"menu");e(this,"towers");e(this,"enemies");e(this,"waves");e(this,"gold");e(this,"playerHealth");e(this,"round");e(this,"resetEventListeners",()=>{H.tileGras.forEach(t=>{t.setShowTowerBp(null),t.updateBG()}),this.towers.hideTowerRange(),this.menu.setSelectedTower(null),h.body.removeAllClassesFromBody()});e(this,"runGame",t=>{if(this.stop){console.log("end");return}t?A(this.lastAnimationTimestamp,this.intervalInMiliseconds)&&(this.lastAnimationTimestamp=t,this.update()):this.update(),requestAnimationFrame(this.runGame)});e(this,"stopGame",()=>{this.stop=!0});e(this,"update",()=>{if(this.playerHealth.getCurrentHealth()<=0){this.stopGame(),new De(ae.LOST);return}h.ctxGame.clearRect(0,0,h.canvasGame.width,h.canvasGame.height),this.enemies.update(),this.towers.update(),H.update(),this.round.update()});this.menu=new _,this.towers=new Vt,this.enemies=new st,this.waves=new L,this.gold=new nt,this.playerHealth=new Ut,this.round=new $t(this),H.createTileGrid(),H.buildTileImg(),this.runGame()}}const I=async s=>{const t=new Image(64,64);return t.src=s,await t.decode(),t},Zt="/tower-defense/assets/arcaneArcher.93169575.png",_t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAFCAYAAAA3zK6FAAAAAXNSR0IArs4c6QAAAFpJREFUKJFjYBjkgBFd4FnCr/8MDAwM4nosEAUG3xgYGBgYmJx4MNRSA/zt+/ef0eAbTvNxWgpzKAMDwrEYmqGOJwT+X+DCEHt56Q+cLa7HwoDLkYM+BAc9AADKMh8EGHHFLAAAAABJRU5ErkJggg==",ei="/tower-defense/assets/arcaneArcherMenu.d9b73d9a.png",ti="/tower-defense/assets/textures.3afee45f.png",ii="/tower-defense/assets/skeletonShield.d1002680.png",si="/tower-defense/assets/mushroom.14731a48.png",ni="/tower-defense/assets/goblin.5ef62492.png",ai="/tower-defense/assets/fireMage.0977364e.png",ri="/tower-defense/assets/fireMageProjectile.1200d795.png",oi="/tower-defense/assets/fireMageMenu.4c064c7f.png",hi="/tower-defense/assets/fireWorm.a9e32668.png",li="/tower-defense/assets/demon.e8dd8c44.png",ci="/tower-defense/assets/lightningMage.e144c4dc.png",di="/tower-defense/assets/lightningMageProjectile.8810b3c2.png",mi="/tower-defense/assets/lightningMageMenu.138d9d4b.png";class ui{constructor(){e(this,"textures",null);e(this,"arcaneArcher",null);e(this,"arcaneArcherProjectile",null);e(this,"arcaneArcherBp",null);e(this,"fireMage",null);e(this,"fireMageProjectile",null);e(this,"fireMageBp",null);e(this,"lightningMage",null);e(this,"lightningMageProjectile",null);e(this,"lightningMageBp",null);e(this,"skeletonShield",null);e(this,"mushroom",null);e(this,"goblin",null);e(this,"fireWorm",null);e(this,"demon",null);e(this,"loadImages",async()=>{this.textures=await I(ti),this.arcaneArcher=await I(Zt),this.arcaneArcherProjectile=await I(_t),this.arcaneArcherBp=await I(ei),this.fireMage=await I(ai),this.fireMageProjectile=await I(ri),this.fireMageBp=await I(oi),this.lightningMage=await I(ci),this.lightningMageProjectile=await I(di),this.lightningMageBp=await I(mi),this.skeletonShield=await I(ii),this.mushroom=await I(si),this.goblin=await I(ni),this.fireWorm=await I(hi),this.demon=await I(li)});e(this,"getImage",t=>{const i=this[t];if(i===null)throw new Error("Images not loaded yet");return i})}}class gi{constructor(){e(this,"columLength",8);e(this,"rowLength",16);e(this,"tileWdith",64);e(this,"tileHeight",this.tileWdith);e(this,"tilesTotal",this.columLength*this.rowLength);e(this,"pathConfiguration",[{id:32,direction:"horizontal"},{id:33,direction:"horizontal"},{id:34,direction:"corner"},{id:50,direction:"vertical"},{id:66,direction:"vertical"},{id:82,direction:"vertical"},{id:98,direction:"corner"},{id:99,direction:"horizontal"},{id:100,direction:"horizontal"},{id:101,direction:"corner"},{id:85,direction:"vertical"},{id:69,direction:"vertical"},{id:53,direction:"vertical"},{id:37,direction:"vertical"},{id:21,direction:"corner"},{id:22,direction:"horizontal"},{id:23,direction:"horizontal"},{id:24,direction:"horizontal"},{id:25,direction:"horizontal"},{id:26,direction:"corner"},{id:42,direction:"vertical"},{id:58,direction:"vertical"},{id:74,direction:"corner"},{id:73,direction:"horizontal"},{id:72,direction:"corner"},{id:88,direction:"vertical"},{id:104,direction:"corner"},{id:105,direction:"horizontal"},{id:106,direction:"horizontal"},{id:107,direction:"horizontal"},{id:108,direction:"horizontal"},{id:109,direction:"corner"},{id:93,direction:"vertical"},{id:77,direction:"vertical"},{id:61,direction:"vertical"},{id:45,direction:"vertical"},{id:29,direction:"vertical"},{id:13,direction:"vertical"}]);e(this,"pathEndPoint",{x:864,y:-32});e(this,"tileRows",[]);e(this,"tilePaths",[]);e(this,"tileGras",[]);e(this,"debug",!1);e(this,"getTileX",t=>t%this.rowLength*this.tileWdith);e(this,"getTileY",()=>this.tileRows.length*this.tileWdith);e(this,"createTileGrid",()=>{for(let t=0,i=[];t<this.tilesTotal;t++){const n=this.pathConfiguration.find(a=>a.id===t);if(n!==void 0){const a=new Oe(t,this.getTileX(t),this.getTileY(),n.direction);i.push(a),this.tilePaths.push(a)}else{const a=new R(t,this.getTileX(t),this.getTileY());i.push(a),this.tileGras.push(a)}i.length===this.rowLength&&(this.tileRows.push(i),i=[])}});e(this,"buildTileImg",()=>{this.tileRows.forEach(t=>{t.forEach(i=>{i.updateBG()})})});e(this,"getTileRows",()=>this.tileRows);e(this,"getTilePaths",()=>this.tilePaths);e(this,"getPathConfiguration",()=>this.pathConfiguration);e(this,"getPathConfigurationCorners",()=>this.getPathConfiguration().filter(t=>t.direction==="corner").map(t=>t.id));e(this,"getPathEndPoint",()=>this.pathEndPoint);e(this,"getPathNodes",()=>[...this.getTilePaths().filter(t=>t.direction==="corner").sort((t,i)=>this.getPathConfigurationCorners().indexOf(t.id)-this.getPathConfigurationCorners().indexOf(i.id)).map(t=>({x:t.x+32,y:t.y+32})),this.getPathEndPoint()]);e(this,"updateTilesGras",()=>{this.tileGras.forEach(t=>t.update())});e(this,"update",()=>{this.updateTilesGras()});e(this,"drawGrid",()=>{this.debug?this.tileRows.forEach(t=>{t.forEach(i=>{i.updateBG()})}):this.tileRows.forEach(t=>{t.forEach(i=>{i.drawGrid()})}),this.debug=!this.debug})}}class fi{constructor(){e(this,"loadingScreen");e(this,"removeLoadingScreen",()=>{this.loadingScreen.remove()});this.loadingScreen=document.createElement("div"),this.loadingScreen.id="loading-screen",this.loadingScreen.classList.add("box-shadow"),this.loadingScreen.innerHTML="Loading...",document.body.appendChild(this.loadingScreen)}}class wi{constructor(t){e(this,"startScreen");e(this,"startButton");e(this,"buttonCallback");e(this,"scaleInTransform",[{transform:"translate(-50%, -50%) scale(1)"},{transform:"translate(-50%, -50%) scale(0.9)"}]);e(this,"scaleInTiming",100);this.buttonCallback=t,this.startScreen=document.createElement("div"),this.startScreen.id="start-screen",this.startScreen.classList.add("box-shadow"),this.startButton=document.createElement("button"),this.startButton.id="start-button",this.startButton.classList.add("box-shadow"),this.startButton.innerHTML="START",this.startButton.addEventListener("click",()=>{this.removeStartScreen()}),this.startScreen.appendChild(this.startButton),document.body.appendChild(this.startScreen)}removeStartScreen(){this.startScreen.animate(this.scaleInTransform,this.scaleInTiming),setTimeout(()=>{this.startScreen.remove(),this.buttonCallback()},this.scaleInTiming)}}let h,H,d;class pi{constructor(){e(this,"loadingScreen");e(this,"imageController");e(this,"initiateGame",()=>{h=new it,H=new gi,d=new Qt});this.loadingScreen=new fi,this.imageController=new ui,this.imageController.loadImages().then(()=>{this.loadingScreen.removeLoadingScreen(),new wi(this.initiateGame)})}}const N=new pi;
